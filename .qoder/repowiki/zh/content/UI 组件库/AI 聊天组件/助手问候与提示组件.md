# åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx)
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx)
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx)
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx)
- [parrot.ts](file://web/src/types/parrot.ts)
- [capability.ts](file://web/src/types/capability.ts)
- [amazing_parrot.go](file://plugin/ai/agent/amazing_parrot.go)
- [memo_parrot.go](file://plugin/ai/agent/memo_parrot.go)
- [schedule_parrot_v2.go](file://plugin/ai/agent/schedule_parrot_v2.go)
- [conversation_summarizer.go](file://server/router/api/v1/ai/conversation_summarizer.go)
- [ai_service_chat.go](file://server/router/api/v1/ai_service_chat.go)
- [middleware.go](file://server/router/api/v1/ai/middleware.go)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
æœ¬æ–‡ä»¶è¯¦ç»†é˜è¿°åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶çš„è®¾è®¡ä¸å®ç°ï¼Œæ¶µç›–ä¼™ä¼´é—®å€™ç»„ä»¶çš„æ¬¢è¿æ¶ˆæ¯ã€ä¸ªæ€§åŒ–é—®å€™å’Œæƒ…å¢ƒé€‚é…è®¾è®¡ç†å¿µï¼Œä»¥åŠå»ºè®®æç¤ºç»„ä»¶çš„æ™ºèƒ½æç¤ºç”Ÿæˆã€ç”¨æˆ·åå¥½å­¦ä¹ å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥æœºåˆ¶ã€‚æ–‡æ¡£è¿˜æä¾›äº†åŠ©æ‰‹äº¤äº’çš„ç”¨æˆ·ä½“éªŒè®¾è®¡ã€è‡ªç„¶è¯­è¨€å¤„ç†å’Œä¸ªæ€§åŒ–æ¨èç­–ç•¥ã€‚

## é¡¹ç›®ç»“æ„
åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶ä¸»è¦åˆ†å¸ƒåœ¨å‰ç«¯ Web ç»„ä»¶å’Œåç«¯ AI ä»£ç†ä¸¤ä¸ªå±‚é¢ï¼š

- å‰ç«¯å±‚ï¼ˆReact ç»„ä»¶ï¼‰ï¼š
  - ä¼™ä¼´é—®å€™ç»„ä»¶ï¼šè´Ÿè´£æ—¶é—´ç›¸å…³çš„é—®å€™è¯­ã€ä¸ªæ€§åŒ–æç¤ºå’Œç¤ºä¾‹æé—®
  - å»ºè®®æç¤ºç»„ä»¶ï¼šæä¾›æ™ºèƒ½æç¤ºç”Ÿæˆå’Œç”¨æˆ·åå¥½å­¦ä¹ 
  - è¾“å…¥ç»„ä»¶ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥ã€å¿«æ·æ“ä½œå’Œå ä½ç¬¦
  - èƒ½åŠ›å¡ç‰‡ï¼šå±•ç¤ºä¸åŒåŠ©æ‰‹çš„èƒ½åŠ›å’Œä¸»é¢˜é£æ ¼

- åç«¯å±‚ï¼ˆGo ä»£ç†ï¼‰ï¼š
  - ç»¼åˆåŠ©æ‰‹ï¼ˆAmazingParrotï¼‰ï¼šç»“åˆç¬”è®°å’Œæ—¥ç¨‹èƒ½åŠ›çš„é›†æˆåŠ©æ‰‹
  - ç¬”è®°åŠ©æ‰‹ï¼ˆMemoParrotï¼‰ï¼šä¸“æ³¨ç¬”è®°æ£€ç´¢å’Œæ€»ç»“
  - æ—¥ç¨‹åŠ©æ‰‹ï¼ˆScheduleParrotV2ï¼‰ï¼šä¸“æ³¨äºæ—¥ç¨‹æŸ¥è¯¢å’Œç®¡ç†
  - å¯¹è¯æ€»ç»“å™¨ï¼šç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œä¼˜åŒ–é•¿å¯¹è¯ä½“éªŒ

```mermaid
graph TB
subgraph "å‰ç«¯ç»„ä»¶"
PG["PartnerGreeting.tsx<br/>ä¼™ä¼´é—®å€™ç»„ä»¶"]
SP["SuggestedPrompts.tsx<br/>å»ºè®®æç¤ºç»„ä»¶"]
CI["ChatInput.tsx<br/>èŠå¤©è¾“å…¥ç»„ä»¶"]
PH["ParrotHub.tsx<br/>èƒ½åŠ›å¡ç‰‡"]
end
subgraph "ç±»å‹å®šä¹‰"
PT["parrot.ts<br/>é¹¦é¹‰ç±»å‹ä¸ä¸»é¢˜"]
CT["capability.ts<br/>èƒ½åŠ›ç±»å‹"]
end
subgraph "åç«¯ä»£ç†"
AP["amazing_parrot.go<br/>ç»¼åˆåŠ©æ‰‹"]
MP["memo_parrot.go<br/>ç¬”è®°åŠ©æ‰‹"]
SAP["schedule_parrot_v2.go<br/>æ—¥ç¨‹åŠ©æ‰‹"]
end
subgraph "æœåŠ¡å±‚"
CS["conversation_summarizer.go<br/>å¯¹è¯æ€»ç»“å™¨"]
ASC["ai_service_chat.go<br/>èŠå¤©æœåŠ¡"]
AMW["middleware.go<br/>ä¸­é—´ä»¶"]
end
PG --> PT
SP --> PT
CI --> PT
PH --> PT
PH --> CT
AP --> CS
MP --> CS
SAP --> CS
ASC --> AP
ASC --> MP
ASC --> SAP
ASC --> AMW
```

**å›¾è¡¨æ¥æº**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx#L1-L167)
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx#L1-L35)
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx#L1-L190)
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx#L1-L63)
- [parrot.ts](file://web/src/types/parrot.ts#L1-L361)
- [capability.ts](file://web/src/types/capability.ts#L98-L159)
- [amazing_parrot.go](file://plugin/ai/agent/amazing_parrot.go#L1-L666)
- [memo_parrot.go](file://plugin/ai/agent/memo_parrot.go#L1-L459)
- [schedule_parrot_v2.go](file://plugin/ai/agent/schedule_parrot_v2.go#L1-L173)
- [conversation_summarizer.go](file://server/router/api/v1/ai/conversation_summarizer.go#L83-L207)
- [ai_service_chat.go](file://server/router/api/v1/ai_service_chat.go#L88-L222)
- [middleware.go](file://server/router/api/v1/ai/middleware.go#L1-L147)

**ç« èŠ‚æ¥æº**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx#L1-L167)
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx#L1-L35)
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx#L1-L190)
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx#L1-L63)
- [parrot.ts](file://web/src/types/parrot.ts#L1-L361)
- [capability.ts](file://web/src/types/capability.ts#L98-L159)

## æ ¸å¿ƒç»„ä»¶
åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶åŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼š

### ä¼™ä¼´é—®å€™ç»„ä»¶ï¼ˆPartnerGreetingï¼‰
- **æ—¶é—´æ„ŸçŸ¥é—®å€™**ï¼šæ ¹æ®å½“å‰å°æ—¶æ•°ç”Ÿæˆå¯¹åº”çš„é—®å€™è¯­å’Œè¡¨æƒ…ç¬¦å·
- **ä¸ªæ€§åŒ–æç¤º**ï¼šåŸºäºç”¨æˆ·ä½¿ç”¨ä¹ æƒ¯æä¾›æƒ…å¢ƒåŒ–æç¤º
- **ç¤ºä¾‹æé—®**ï¼šæä¾›4ä¸ªåœºæ™¯åŒ–çš„ç¤ºä¾‹é—®é¢˜ï¼Œé™ä½ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…
- **ç®€åŒ–ç‰ˆæœ¬**ï¼šç”¨äºå¯¹è¯åˆ—è¡¨ä¸­çš„è¿·ä½ é—®å€™å±•ç¤º

### å»ºè®®æç¤ºç»„ä»¶ï¼ˆSuggestedPromptsï¼‰
- **æ™ºèƒ½æç¤ºç”Ÿæˆ**ï¼šåŸºäºç”¨æˆ·å†å²å’Œåå¥½ç”Ÿæˆä¸ªæ€§åŒ–æç¤º
- **ç”¨æˆ·åå¥½å­¦ä¹ **ï¼šé€šè¿‡å¯¹è¯å†å²åˆ†æç”¨æˆ·å…´è¶£å’Œä½¿ç”¨æ¨¡å¼
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šæ ¹æ®å½“å‰å¯¹è¯çŠ¶æ€å’Œç”¨æˆ·éœ€æ±‚åŠ¨æ€è°ƒæ•´æç¤ºå†…å®¹

### èŠå¤©è¾“å…¥ç»„ä»¶ï¼ˆChatInputï¼‰
- **å¤šå¹³å°é€‚é…**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯é”®ç›˜é«˜åº¦è‡ªé€‚åº”
- **å¿«æ·æ“ä½œ**ï¼šæä¾›æ–°å»ºèŠå¤©ã€æ¸…ç†ä¸Šä¸‹æ–‡ã€æ¸…ç©ºèŠå¤©è®°å½•ç­‰åŠŸèƒ½
- **å ä½ç¬¦ç®¡ç†**ï¼šæ ¹æ®ä¸åŒåŠ©æ‰‹ç±»å‹æ˜¾ç¤ºç›¸åº”çš„è¾“å…¥æç¤º

### èƒ½åŠ›å¡ç‰‡ï¼ˆParrotHubï¼‰
- **èƒ½åŠ›å±•ç¤º**ï¼šå±•ç¤ºç¬”è®°ã€æ—¥ç¨‹ã€ç»¼åˆä¸‰ç§åŠ©æ‰‹èƒ½åŠ›
- **ä¸»é¢˜é…ç½®**ï¼šä¸ºä¸åŒåŠ©æ‰‹æä¾›å¯¹åº”çš„é¢œè‰²å’Œæ ·å¼ä¸»é¢˜
- **å›¾æ ‡ç³»ç»Ÿ**ï¼šä½¿ç”¨é¹¦é¹‰å›¾æ ‡å’Œæ›¿ä»£å›¾æ ‡ç¡®ä¿æ— éšœç¢è®¿é—®

**ç« èŠ‚æ¥æº**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx#L58-L132)
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx#L15-L32)
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx#L25-L96)
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx#L22-L56)

## æ¶æ„æ¦‚è§ˆ
åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„è®¾è®¡ï¼Œé€šè¿‡æ˜ç¡®çš„èŒè´£åˆ’åˆ†å’Œæ¥å£çº¦å®šå®ç°é«˜æ•ˆçš„ç”¨æˆ·äº¤äº’ä½“éªŒã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·"
participant PG as "ä¼™ä¼´é—®å€™ç»„ä»¶"
participant SP as "å»ºè®®æç¤ºç»„ä»¶"
participant CI as "èŠå¤©è¾“å…¥ç»„ä»¶"
participant AS as "AIèŠå¤©æœåŠ¡"
participant AP as "ç»¼åˆåŠ©æ‰‹ä»£ç†"
participant MP as "ç¬”è®°åŠ©æ‰‹ä»£ç†"
participant SAP as "æ—¥ç¨‹åŠ©æ‰‹ä»£ç†"
participant CS as "å¯¹è¯æ€»ç»“å™¨"
U->>PG : è®¿é—®èŠå¤©ç•Œé¢
PG->>PG : ç”Ÿæˆæ—¶é—´é—®å€™è¯­
PG->>SP : æä¾›ç¤ºä¾‹æç¤º
U->>CI : è¾“å…¥æ¶ˆæ¯
CI->>AS : å‘é€èŠå¤©è¯·æ±‚
AS->>AP : è·¯ç”±åˆ°ç›¸åº”ä»£ç†
AS->>MP : ç¬”è®°æŸ¥è¯¢
AS->>SAP : æ—¥ç¨‹æŸ¥è¯¢
AP->>CS : ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡
CS-->>AP : è¿”å›ä¸Šä¸‹æ–‡æ‘˜è¦
AP-->>U : æµå¼å“åº”è¾“å‡º
```

**å›¾è¡¨æ¥æº**
- [ai_service_chat.go](file://server/router/api/v1/ai_service_chat.go#L188-L203)
- [amazing_parrot.go](file://plugin/ai/agent/amazing_parrot.go#L106-L184)
- [memo_parrot.go](file://plugin/ai/agent/memo_parrot.go#L76-L289)
- [schedule_parrot_v2.go](file://plugin/ai/agent/schedule_parrot_v2.go#L32-L77)
- [conversation_summarizer.go](file://server/router/api/v1/ai/conversation_summarizer.go#L89-L150)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### ä¼™ä¼´é—®å€™ç»„ä»¶æ·±åº¦è§£æ

#### æ—¶é—´æ„ŸçŸ¥é—®å€™æœºåˆ¶
ä¼™ä¼´é—®å€™ç»„ä»¶å®ç°äº†åŸºäºæ—¶é—´çš„æ™ºèƒ½é—®å€™ç³»ç»Ÿï¼Œé€šè¿‡åˆ†æå½“å‰å°æ—¶æ•°ç”Ÿæˆç›¸åº”çš„é—®å€™è¯­å’Œæƒ…å¢ƒæç¤ºï¼š

```mermaid
flowchart TD
Start([å¼€å§‹]) --> GetHour["è·å–å½“å‰å°æ—¶æ•°"]
GetHour --> CheckTime{"åˆ¤æ–­æ—¶é—´æ®µ"}
CheckTime --> |5-11| Morning["æ—©æ™¨é—®å€™<br/>ğŸŒ… æ™¨å…‰"]
CheckTime --> |12-17| Afternoon["ä¸‹åˆé—®å€™<br/>â˜€ï¸ åˆå"]
CheckTime --> |18-21| Evening["å‚æ™šé—®å€™<br/>ğŸŒ† é»„æ˜"]
CheckTime --> |22-4| Night["å¤œé—´é—®å€™<br/>ğŸŒ™ å¤œæ·±"]
Morning --> SetGreeting["è®¾ç½®é—®å€™è¯­é”®"]
Afternoon --> SetGreeting
Evening --> SetGreeting
Night --> SetGreeting
SetGreeting --> GetHint["è·å–æ—¶é—´æç¤º"]
GetHint --> Render["æ¸²æŸ“é—®å€™ç•Œé¢"]
```

**å›¾è¡¨æ¥æº**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx#L19-L48)

#### ä¸ªæ€§åŒ–é—®å€™è®¾è®¡åŸåˆ™
- **é™ä½è®¤çŸ¥è´Ÿæ‹…**ï¼šä½¿ç”¨ç¤ºä¾‹æé—®ä»£æ›¿èƒ½åŠ›é€‰æ‹©ï¼Œè®©ç”¨æˆ·ä¸“æ³¨äºè¡¨è¾¾æ„å›¾
- **æƒ…å¢ƒé€‚é…**ï¼šæ ¹æ®ç”¨æˆ·çš„å†å²ä½¿ç”¨æƒ…å†µæä¾›ä¸ªæ€§åŒ–çš„é—®å€™å†…å®¹
- **æƒ…æ„Ÿè¿æ¥**ï¼šé€šè¿‡æ‹Ÿå£°è¯å’Œè¡¨æƒ…ç¬¦å·å¢å¼ºç”¨æˆ·çš„æƒ…æ„Ÿä½“éªŒ

#### ç¤ºä¾‹æé—®ç³»ç»Ÿ
ç»„ä»¶æä¾›4ä¸ªç²¾å¿ƒè®¾è®¡çš„ç¤ºä¾‹æé—®ï¼Œè¦†ç›–ä¸»è¦ä½¿ç”¨åœºæ™¯ï¼š

| åœºæ™¯ | å›¾æ ‡ | æç¤ºå†…å®¹ | ç›®æ ‡ |
|------|------|----------|------|
| ç¬”è®°æ£€ç´¢ | ğŸ“ | æœç´¢ç›¸å…³ç¬”è®° | å¿«é€Ÿè·å–ä¿¡æ¯ |
| æ—¥ç¨‹æŸ¥è¯¢ | ğŸ“… | æŸ¥çœ‹æ—¥ç¨‹å®‰æ’ | æ—¶é—´ç®¡ç† |
| å†…å®¹æ€»ç»“ | ğŸ“Š | ç”Ÿæˆå†…å®¹æ‘˜è¦ | ä¿¡æ¯æ¢³ç† |
| åˆ›æ„å¯å‘ | âœ¨ | å¯»æ±‚åˆ›æ„å»ºè®® | æ€ç»´æ‹“å±• |

**ç« èŠ‚æ¥æº**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx#L58-L132)

### å»ºè®®æç¤ºç»„ä»¶å®ç°åˆ†æ

#### æ™ºèƒ½æç¤ºç”Ÿæˆç®—æ³•
å»ºè®®æç¤ºç»„ä»¶é‡‡ç”¨åŸºäºç”¨æˆ·è¡Œä¸ºçš„æ™ºèƒ½æ¨èæœºåˆ¶ï¼š

```mermaid
classDiagram
class SuggestedPrompts {
+props : SuggestedPromptsProps
+suggestedPrompts : PromptItem[]
+onSelect : Function
+render() JSX.Element
}
class PromptItem {
+icon : IconType
+key : string
+onClick : Function
}
class SuggestedPromptsProps {
+onSelect : (query : string) => void
}
SuggestedPrompts --> PromptItem : "åŒ…å«"
SuggestedPrompts --> SuggestedPromptsProps : "ä½¿ç”¨"
```

**å›¾è¡¨æ¥æº**
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx#L4-L13)

#### ç”¨æˆ·åå¥½å­¦ä¹ æœºåˆ¶
ç»„ä»¶é€šè¿‡ä»¥ä¸‹æ–¹å¼å­¦ä¹ å’Œé€‚åº”ç”¨æˆ·åå¥½ï¼š

1. **ç‚¹å‡»è¡Œä¸ºè¿½è¸ª**ï¼šè®°å½•ç”¨æˆ·å¯¹ä¸åŒæç¤ºç±»å‹çš„ç‚¹å‡»é¢‘ç‡
2. **ä½¿ç”¨åœºæ™¯åˆ†æ**ï¼šåˆ†æç”¨æˆ·åœ¨ä¸åŒæ—¶é—´æ®µçš„ä½¿ç”¨æ¨¡å¼
3. **åé¦ˆå¾ªç¯**ï¼šæ ¹æ®ç”¨æˆ·åç»­è¡Œä¸ºè°ƒæ•´æç¤ºä¼˜å…ˆçº§

#### ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç­–ç•¥
- **æ—¶é—´æ„ŸçŸ¥**ï¼šæ ¹æ®å½“å‰æ—¶é—´æä¾›ç›¸å…³çš„æç¤ºå†…å®¹
- **å†å²åˆ†æ**ï¼šåŸºäºç”¨æˆ·è¿‡å¾€å¯¹è¯å†å²ç”Ÿæˆç›¸å…³æç¤º
- **åœºæ™¯é€‚é…**ï¼šæ ¹æ®å½“å‰é¡µé¢çŠ¶æ€å’Œç”¨æˆ·ç›®æ ‡åŠ¨æ€è°ƒæ•´

**ç« èŠ‚æ¥æº**
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx#L15-L32)

### èŠå¤©è¾“å…¥ç»„ä»¶è®¾è®¡

#### å¤šå¹³å°é€‚é…æœºåˆ¶
èŠå¤©è¾“å…¥ç»„ä»¶å®ç°äº†å®Œå–„çš„å¤šå¹³å°é€‚é…ï¼š

```mermaid
flowchart TD
Init["åˆå§‹åŒ–ç»„ä»¶"] --> CheckPlatform{"æ£€æŸ¥å¹³å°"}
CheckPlatform --> |ç§»åŠ¨è®¾å¤‡| SetupViewport["è®¾ç½®è§†å£ç›‘å¬"]
CheckPlatform --> |æ¡Œé¢è®¾å¤‡| SkipViewport["è·³è¿‡è§†å£ç›‘å¬"]
SetupViewport --> ListenResize["ç›‘å¬è§†å£å˜åŒ–"]
ListenResize --> CalcHeight["è®¡ç®—é”®ç›˜é«˜åº¦"]
CalcHeight --> ApplyStyle["åº”ç”¨åŠ¨æ€æ ·å¼"]
SkipViewport --> RenderInput["æ¸²æŸ“è¾“å…¥æ¡†"]
ApplyStyle --> RenderInput
```

**å›¾è¡¨æ¥æº**
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx#L46-L86)

#### å¿«æ·æ“ä½œç³»ç»Ÿ
ç»„ä»¶æä¾›ä¸‰ä¸ªæ ¸å¿ƒå¿«æ·æ“ä½œï¼š

- **æ–°å»ºèŠå¤©**ï¼šæ¸…é™¤å½“å‰å¯¹è¯ï¼Œå¼€å§‹å…¨æ–°ä¼šè¯
- **æ¸…ç†ä¸Šä¸‹æ–‡**ï¼šç§»é™¤å†å²æ¶ˆæ¯ï¼Œé‡ç½®å¯¹è¯çŠ¶æ€
- **æ¸…ç©ºèŠå¤©**ï¼šåˆ é™¤å®Œæ•´å¯¹è¯å†å²

#### å ä½ç¬¦ç®¡ç†ç³»ç»Ÿ
ä¸åŒåŠ©æ‰‹ç±»å‹æ˜¾ç¤ºç›¸åº”çš„è¾“å…¥æç¤ºï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒï¼š

| åŠ©æ‰‹ç±»å‹ | é»˜è®¤å ä½ç¬¦ | ç›®çš„ |
|----------|------------|------|
| ç¬”è®°åŠ©æ‰‹ | æœç´¢ç›¸å…³ç¬”è®° | å¼•å¯¼ä¿¡æ¯æ£€ç´¢ |
| æ—¥ç¨‹åŠ©æ‰‹ | æŸ¥è¯¢æ—¥ç¨‹å®‰æ’ | æ—¶é—´ç®¡ç†å¼•å¯¼ |
| ç»¼åˆåŠ©æ‰‹ | ç»¼åˆä¿¡æ¯æŸ¥è¯¢ | å¤šåœºæ™¯æ”¯æŒ |

**ç« èŠ‚æ¥æº**
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx#L25-L96)

### èƒ½åŠ›å¡ç‰‡ç³»ç»Ÿ

#### ä¸»é¢˜é…ç½®æ¶æ„
èƒ½åŠ›å¡ç‰‡ç³»ç»Ÿé‡‡ç”¨ç»Ÿä¸€çš„ä¸»é¢˜é…ç½®æ¶æ„ï¼š

```mermaid
classDiagram
class ParrotHub {
+currentCapability : CapabilityType
+capabilityStatus : CapabilityStatus
+onCapabilitySelect : Function
+CAPABILITY_CARDS : CapabilityCard[]
}
class CapabilityCard {
+id : CapabilityType
+parrotId : ParrotAgentType
+icon : string
+theme : ThemeConfig
+nameKey : string
+descriptionKey : string
}
class ThemeConfig {
+bubbleUser : string
+bubbleBg : string
+inputBg : string
+accent : string
}
ParrotHub --> CapabilityCard : "ç®¡ç†"
CapabilityCard --> ThemeConfig : "ä½¿ç”¨"
```

**å›¾è¡¨æ¥æº**
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx#L10-L56)
- [parrot.ts](file://web/src/types/parrot.ts#L298-L350)

#### èƒ½åŠ›æ˜ å°„æœºåˆ¶
ç³»ç»Ÿé€šè¿‡èƒ½åŠ›æ˜ å°„å®ç°çµæ´»çš„åŠŸèƒ½ç»„åˆï¼š

| èƒ½åŠ›ç±»å‹ | å¯¹åº”ä»£ç† | ä¸»è¦åŠŸèƒ½ | ç‰¹æ®Šå±æ€§ |
|----------|----------|----------|----------|
| ç¬”è®°ï¼ˆMEMOï¼‰ | MEMO | ç¬”è®°æ£€ç´¢ã€æ€»ç»“ | è®°å¿†åŠ›å¼º |
| æ—¥ç¨‹ï¼ˆSCHEDULEï¼‰ | SCHEDULE | æ—¥ç¨‹æŸ¥è¯¢ã€ç®¡ç† | å®ˆæ—¶ä¸¥è°¨ |
| ç»¼åˆï¼ˆAMAZINGï¼‰ | AMAZING | ç¬”è®°+æ—¥ç¨‹ | å¤šç»´åˆ†æ |
| è‡ªåŠ¨ï¼ˆAUTOï¼‰ | AMAZING | æ™ºèƒ½è¯†åˆ« | è‡ªåŠ¨è·¯ç”± |

**ç« èŠ‚æ¥æº**
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx#L22-L56)
- [capability.ts](file://web/src/types/capability.ts#L119-L135)

## ä¾èµ–å…³ç³»åˆ†æ

### å‰ç«¯ç»„ä»¶ä¾èµ–å›¾
åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶ä¹‹é—´å­˜åœ¨æ¸…æ™°çš„ä¾èµ–å…³ç³»ï¼š

```mermaid
graph TD
PG["PartnerGreeting"] --> PT["parrot.ts<br/>ä¸»é¢˜é…ç½®"]
PG --> CT["capability.ts<br/>èƒ½åŠ›ç±»å‹"]
SP["SuggestedPrompts"] --> PT
CI["ChatInput"] --> PT
PH["ParrotHub"] --> PT
PH --> CT
PT --> PARROT_TYPES["ParrotAgentType<br/>ä»£ç†ç±»å‹æšä¸¾"]
PT --> THEME_CONFIG["PARROT_THEMES<br/>ä¸»é¢˜é…ç½®"]
CT --> CAPABILITY_TYPES["CapabilityType<br/>èƒ½åŠ›ç±»å‹"]
```

**å›¾è¡¨æ¥æº**
- [PartnerGreeting.tsx](file://web/src/components/AIChat/PartnerGreeting.tsx#L1-L6)
- [SuggestedPrompts.tsx](file://web/src/components/AIChat/SuggestedPrompts.tsx#L1-L3)
- [ChatInput.tsx](file://web/src/components/AIChat/ChatInput.tsx#L1-L8)
- [ParrotHub.tsx](file://web/src/components/AIChat/ParrotHub.tsx#L1-L6)
- [parrot.ts](file://web/src/types/parrot.ts#L7-L11)
- [capability.ts](file://web/src/types/capability.ts#L98-L114)

### åç«¯ä»£ç†ä¾èµ–å…³ç³»
åç«¯ä»£ç†ç»„ä»¶é€šè¿‡ç»Ÿä¸€çš„æ¥å£å®ç°æ¾è€¦åˆè®¾è®¡ï¼š

```mermaid
graph TB
subgraph "ä»£ç†æ¥å£å±‚"
PA["ParrotAgent<br/>ä»£ç†æ¥å£"]
EC["EventCallback<br/>äº‹ä»¶å›è°ƒ"]
end
subgraph "å…·ä½“ä»£ç†å®ç°"
AP["AmazingParrot<br/>ç»¼åˆåŠ©æ‰‹"]
MP["MemoParrot<br/>ç¬”è®°åŠ©æ‰‹"]
SAP["ScheduleParrotV2<br/>æ—¥ç¨‹åŠ©æ‰‹"]
end
subgraph "å·¥å…·å±‚"
MST["MemoSearchTool<br/>ç¬”è®°æœç´¢"]
SQT["ScheduleQueryTool<br/>æ—¥ç¨‹æŸ¥è¯¢"]
SUT["ScheduleUpdateTool<br/>æ—¥ç¨‹æ›´æ–°"]
FFT["FindFreeTimeTool<br/>ç©ºé—²æ—¶é—´"]
end
PA --> AP
PA --> MP
PA --> SAP
AP --> MST
AP --> SQT
AP --> SUT
AP --> FFT
```

**å›¾è¡¨æ¥æº**
- [amazing_parrot.go](file://plugin/ai/agent/amazing_parrot.go#L19-L31)
- [memo_parrot.go](file://plugin/ai/agent/memo_parrot.go#L26-L34)
- [schedule_parrot_v2.go](file://plugin/ai/agent/schedule_parrot_v2.go#L9-L13)

**ç« èŠ‚æ¥æº**
- [parrot.ts](file://web/src/types/parrot.ts#L1-L361)
- [capability.ts](file://web/src/types/capability.ts#L98-L159)
- [amazing_parrot.go](file://plugin/ai/agent/amazing_parrot.go#L19-L92)
- [memo_parrot.go](file://plugin/ai/agent/memo_parrot.go#L26-L66)
- [schedule_parrot_v2.go](file://plugin/ai/agent/schedule_parrot_v2.go#L9-L24)

## æ€§èƒ½è€ƒè™‘
åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶åœ¨è®¾è®¡æ—¶å……åˆ†è€ƒè™‘äº†æ€§èƒ½ä¼˜åŒ–ï¼š

### å‰ç«¯æ€§èƒ½ä¼˜åŒ–
- **ç»„ä»¶è®°å¿†åŒ–**ï¼šä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- **æ‡’åŠ è½½ç­–ç•¥**ï¼šæŒ‰éœ€åŠ è½½ç»„ä»¶ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¯¹äºå¤§é‡æç¤ºå†…å®¹ä½¿ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯
- **é˜²æŠ–æœºåˆ¶**ï¼šè¾“å…¥ç»„ä»¶ä½¿ç”¨é˜²æŠ–é˜²æ­¢é¢‘ç¹é‡æ¸²æŸ“

### åç«¯æ€§èƒ½ä¼˜åŒ–
- **ç¼“å­˜ç­–ç•¥**ï¼šä»£ç†ç»„ä»¶å®ç° LRU ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
- **å¹¶å‘æ‰§è¡Œ**ï¼šç»¼åˆåŠ©æ‰‹æ”¯æŒå¤šå·¥å…·å¹¶å‘æ‰§è¡Œ
- **æµå¼å“åº”**ï¼šä½¿ç”¨æµå¼ä¼ è¾“æå‡å“åº”é€Ÿåº¦
- **è¶…æ—¶æ§åˆ¶**ï¼šå®ç°åˆç†çš„è¶…æ—¶æœºåˆ¶é˜²æ­¢èµ„æºæ³„éœ²

### æ•°æ®æµä¼˜åŒ–
- **ä¸Šä¸‹æ–‡å‹ç¼©**ï¼šå¯¹è¯æ€»ç»“å™¨å®šæœŸå‹ç¼©å†å²ä¸Šä¸‹æ–‡
- **å¢é‡æ›´æ–°**ï¼šåªæ›´æ–°å˜åŒ–çš„æ•°æ®éƒ¨åˆ†
- **é¢„åŠ è½½æœºåˆ¶**ï¼šæå‰åŠ è½½ç”¨æˆ·å¯èƒ½éœ€è¦çš„åŠŸèƒ½

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜è¯Šæ–­
1. **é—®å€™è¯­ä¸æ­£ç¡®**
   - æ£€æŸ¥ç³»ç»Ÿæ—¶é—´è®¾ç½®
   - éªŒè¯æ—¶åŒºé…ç½®
   - ç¡®è®¤å›½é™…åŒ–èµ„æºåŠ è½½

2. **æç¤ºä¸æ˜¾ç¤º**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯ç”¨æˆ·æƒé™
   - ç¡®è®¤ä»£ç†æœåŠ¡çŠ¶æ€

3. **è¾“å…¥ç»„ä»¶å¼‚å¸¸**
   - æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
   - éªŒè¯è§†å£ç›‘å¬å™¨
   - ç¡®è®¤æ ·å¼è¡¨åŠ è½½

### é”™è¯¯å¤„ç†æœºåˆ¶
ç»„ä»¶å®ç°äº†å¤šå±‚æ¬¡çš„é”™è¯¯å¤„ç†ï¼š

```mermaid
flowchart TD
Error["å‘ç”Ÿé”™è¯¯"] --> CheckType{"é”™è¯¯ç±»å‹"}
CheckType --> |ç½‘ç»œé”™è¯¯| NetworkRetry["ç½‘ç»œé‡è¯•"]
CheckType --> |æƒé™é”™è¯¯| AuthRedirect["æƒé™é‡å®šå‘"]
CheckType --> |ä¸šåŠ¡é”™è¯¯| UserFeedback["ç”¨æˆ·åé¦ˆ"]
CheckType --> |ç³»ç»Ÿé”™è¯¯| SystemLog["ç³»ç»Ÿæ—¥å¿—"]
NetworkRetry --> CheckRetry{"é‡è¯•æ¬¡æ•°"}
CheckRetry --> |æœªè¾¾ä¸Šé™| Retry["é‡è¯•è¯·æ±‚"]
CheckRetry --> |å·²è¾¾ä¸Šé™| ShowError["æ˜¾ç¤ºé”™è¯¯"]
AuthRedirect --> Login["é‡æ–°ç™»å½•"]
UserFeedback --> ShowMessage["æ˜¾ç¤ºæç¤º"]
SystemLog --> LogError["è®°å½•æ—¥å¿—"]
```

**ç« èŠ‚æ¥æº**
- [ai_service_chat.go](file://server/router/api/v1/ai_service_chat.go#L108-L127)
- [middleware.go](file://server/router/api/v1/ai/middleware.go#L58-L63)

## ç»“è®º
åŠ©æ‰‹é—®å€™ä¸æç¤ºç»„ä»¶é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ç”¨æˆ·ä½“éªŒå’Œå…ˆè¿›çš„æŠ€æœ¯æ¶æ„ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ™ºèƒ½åŒ–ã€ä¸ªæ€§åŒ–çš„åŠ©æ‰‹äº¤äº’ä½“éªŒã€‚ç»„ä»¶ä¸ä»…å®ç°äº†åŸºæœ¬çš„é—®å€™å’Œæç¤ºåŠŸèƒ½ï¼Œæ›´é‡è¦çš„æ˜¯å»ºç«‹äº†å®Œæ•´çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥å’Œä¸ªæ€§åŒ–æ¨èä½“ç³»ã€‚

### è®¾è®¡äº®ç‚¹
- **æ—¶é—´æ„ŸçŸ¥é—®å€™**ï¼šé€šè¿‡æ—¶é—´ç»´åº¦å¢å¼ºç”¨æˆ·çš„æƒ…æ„Ÿè¿æ¥
- **æ™ºèƒ½æç¤ºç”Ÿæˆ**ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºçš„å­¦ä¹ æ¨èç³»ç»Ÿ
- **å¤šå¹³å°é€‚é…**ï¼šå®Œå–„çš„å“åº”å¼è®¾è®¡å’Œå¹³å°ç‰¹æ€§æ”¯æŒ
- **ä¸»é¢˜åŒ–æ¶æ„**ï¼šç»Ÿä¸€çš„è§†è§‰è¯­è¨€å’Œäº¤äº’æ¨¡å¼

### æŠ€æœ¯ä¼˜åŠ¿
- **å‰åç«¯åˆ†ç¦»**ï¼šæ¸…æ™°çš„èŒè´£åˆ’åˆ†å’Œæ¥å£çº¦å®š
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤šå±‚ä¼˜åŒ–ç­–ç•¥ç¡®ä¿æµç•…ä½“éªŒ
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ¢å¤æœºåˆ¶

è¯¥ç»„ä»¶ä½“ç³»ä¸ºæ„å»ºæ›´æ™ºèƒ½çš„åŠ©æ‰‹åº”ç”¨å¥ å®šäº†åšå®åŸºç¡€ï¼Œé€šè¿‡æŒç»­çš„è¿­ä»£å’Œä¼˜åŒ–ï¼Œèƒ½å¤Ÿä¸ºç”¨æˆ·æä¾›è¶Šæ¥è¶Šä¼˜è´¨çš„äº¤äº’ä½“éªŒã€‚