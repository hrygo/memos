# 🧪 鹦鹉系统测试指南

> **测试时间**: 2025-01-22
> **环境**: 开发服务器运行中
> **访问地址**: http://localhost:25173

---

## ✅ 编译验证结果

### 前端编译
```
✓ built in 9.30s
✅ 0 errors (parrot-related)
✅ All chunks generated successfully
```

### 关键鹦鹉组件
- ✅ AIChat-Z_9YhJr_.js (68.58 kB) - 包含所有鹦鹉功能
- ✅ 所有类型定义正确
- ✅ 所有组件导入成功

---

## 📋 测试清单

### 预备工作
- [ ] 打开浏览器访问 http://localhost:25173
- [ ] 登录到 Memos（如果需要）
- [ ] 导航到 AI Chat 页面

---

### 测试 1: @ 符号触发选择器 ✨

**步骤**:
1. 在聊天输入框中输入 `@`
2. 观察是否弹出鹦鹉选择器

**预期结果**:
- ✅ 弹出鹦鹉选择器（4 个鹦鹉卡片）
- ✅ 显示鹦鹉名称：灰灰、金刚、惊奇、灵灵
- ✅ 可用鹦鹉显示绿色"可用"标签
- ✅ 不可用鹦鹉（惊奇、灵灵）可能显示灰色

**测试验证**:
- [ ] 选择器正确弹出
- [ ] 位置在输入框下方
- [ ] 样式正确（边框、阴影、圆角）
- [ ] 背景透明度正确

---

### 测试 2: 键盘导航 ⌨️

**步骤**:
1. 保持选择器打开状态
2. 按 `↓` 键向下选择
3. 按 `↑` 键向上选择
4. 按 `Enter` 键确认选择
5. 按 `Esc` 键关闭选择器

**预期结果**:
- ✅ `↓` 键：高亮下一个鹦鹉
- ✅ `↑` 键：高亮上一个鹦鹉
- ✅ `Enter` 键：选中鹦鹉，选择器关闭
- ✅ `Esc` 键：关闭选择器，不选择鹦鹉

**测试验证**:
- [ ] 键盘导航流畅
- [ ] 高亮状态正确
- [ ] Enter 键选择鹦鹉成功
- [ ] Esc 键关闭选择器成功

---

### 测试 3: 快捷操作卡片 🎯

**步骤**:
1. 不输入 @ 符号
2. 点击页面上的鹦鹉快捷操作卡片
3. 切换不同的鹦鹉

**预期结果**:
- ✅ 显示 4 个鹦鹉快捷操作卡片
- ✅ 每个卡片显示：鹦鹉图标 + 名称
- ✅ 当前选中的鹦鹉卡片高亮显示
- ✅ 点击卡片可切换鹦鹉

**测试验证**:
- [ ] 快捷操作卡片在输入框上方
- [ ] 4 个卡片都正确显示
- [ ] 点击切换鹦鹉成功
- [ ] 选中状态视觉反馈清晰
- [ ] 颜色主题正确（灰灰=蓝色，金刚=紫色）

---

### 测试 4: 🦜 灰灰（笔记助手）📝

**步骤**:
1. 选择"🦜 灰灰"（笔记助手）
2. 确认状态显示"当前鹦鹉：灰灰"
3. 输入："查询 Python 相关的笔记"
4. 点击发送

**预期结果**:
- ✅ 鹦鹉状态显示"正在思考..."
- ✅ 灰灰检索相关笔记
- ✅ 显示笔记查询结果卡片
- ✅ 结果按相关度排序
- ✅ 每个笔记显示：内容 + 相关度分数

**测试验证**:
- [ ] 状态栏显示灰灰信息
- [ ] 思考指示器显示
- [ ] 笔记查询结果卡片显示
- [ ] 结果包含：笔记内容、相关度分数
- [ ] 点击笔记可以跳转到笔记详情
- [ ] 响应时间 < 5 秒

---

### 测试 5: 🦜 金刚（日程助手）📅

**步骤**:
1. 切换到"🦜 金刚"（日程助手）
2. 输入："明天下午3点开会"
3. 点击发送

**预期结果**:
- ✅ 鹦鹉状态显示"当前鹦鹉：金刚"
- ✅ 金刚处理日程创建
- ✅ 创建日程成功
- ✅ 可能显示日程卡片

**测试验证**:
- [ ] 状态栏显示金刚信息
- [ ] 日程创建成功
- [ ] 日程信息正确（时间、标题）
- [ ] 响应时间 < 5 秒

---

### 测试 6: 默认模式（无鹦鹉）🤖

**步骤**:
1. 点击鹦鹉快捷操作中的灰色卡片（如果选中其他鹦鹉，先点击灰色"默认助手"卡片取消选择）
2. 或刷新页面
3. 输入："总结一下我的笔记"
4. 点击发送

**预期结果**:
- ✅ 使用原有 RAG 系统
- ✅ 检索相关笔记
- ✅ 返回摘要内容
- ✅ 无鹦鹉特定行为

**测试验证**:
- [ ] 原有功能正常工作
- [ ] 笔记检索正常
- [ ] 摘要生成正确
- [ ] 向后兼容

---

### 测试 7: 多轮对话 💬

**步骤**:
1. 选择灰灰
2. 第一条："查询 Python 笔记"
3. 第二条："查询 JavaScript 笔记"
4. 第三条："总结前面的查询结果"

**预期结果**:
- ✅ 每轮对话独立处理
- ✅ 鹦鹉状态持续显示
- ✅ 对话历史保持（如果支持）

**测试验证**:
- [ ] 多轮对话正常
- [ ] 不会混淆上下文
- [ ] 状态持续正确

---

### 测试 8: 切换鹦鹉 🔄

**步骤**:
1. 与灰灰对话
2. 中途切换到金刚
3. 发送日程相关消息

**预期结果**:
- ✅ 切换鹦鹉成功
- ✅ 状态立即更新
- ✅ 后续消息路由到新鹦鹉

**测试验证**:
- [ ] 点击切换卡片立即生效
- [ ] 状态栏更新及时
- [ ] 无需刷新页面

---

## 🐛 已知问题排查

### 问题 1: @ 符号不触发选择器

**可能原因**:
- textareaRef 未正确绑定
- handleInputChange 未调用

**解决方案**:
```bash
# 检查浏览器控制台
# 输入 @ 符号，观察是否有错误日志
```

### 问题 2: 鹦鹉选择器位置错误

**可能原因**:
- getBoundingClientRect 返回值异常
- window.scrollY 计算错误

**解决方案**:
- 刷新页面重试
- 检查页面缩放比例

### 问题 3: 选择鹦鹉后无响应

**可能原因**:
- 后端未启动
- API 路由失败

**解决方案**:
```bash
# 检查后端状态
curl http://localhost:28081/healthz

# 查看浏览器 Network 标签
# 检查是否有 API 请求失败
```

### 问题 4: 笔记查询结果不显示

**可能原因**:
- 事件回调未触发
- onMemoQueryResult 未调用

**解决方案**:
```bash
# 打开浏览器控制台
# 输入 @ 符号，观察日志
# 查找 [Parrot Tool Result] 日志
```

---

## 📊 性能验证

### 响应时间测试
| 功能 | 目标 | 实测 |
|------|------|------|
| @ 触发选择器 | < 100ms | ⏳ |
| 鹦鹉选择响应 | < 50ms | ⏳ |
| 笔记检索（灰灰） | < 2s | ⏳ |
| 日程创建（金刚） | < 3s | ⏳ |
| 首屏加载 | < 1s | ⏳ |

---

## ✅ 验收标准

### 功能验收
- [ ] 所有 8 个测试场景通过
- [ ] 无阻断性 bug
- [ ] 用户体验流畅

### 性能验收
- [ ] 首屏加载 < 1s
- [ ] 交互响应 < 100ms
- [ ] 笔记检索 < 2s
- [ ] 日程响应 < 3s

### 兼容性验收
- [ ] 不影响原有功能
- [ ] 默认模式正常工作
- [ ] 多轮对话正常

---

## 🎯 测试步骤总结

### 快速测试（5 分钟）
1. ✅ 启动服务器
2. ⏳ 测试 @ 触发选择器
3. ⏳ 测试灰灰查询笔记
4. ⏳ 测试金刚创建日程
5. ⏳ 测试默认模式

### 完整测试（15 分钟）
1. ⏳ 所有 8 个测试场景
2. ⏳ 性能指标验证
3. ⏳ 边界情况测试
4. ⏳ 浏览器兼容性

---

## 📝 测试报告模板

### 测试环境
- **日期**: 2025-01-22
- **浏览器**: Chrome/Safari/Firefox
- **URL**: http://localhost:25173
- **用户**: [测试用户名]

### 测试结果
| 测试项 | 状态 | 备注 |
|--------|------|------|
| @ 符号触发 | ⏳ |  |
| 键盘导航 | ⏳ |  |
| 快捷操作卡片 | ⏳ |  |
| 灰灰笔记查询 | ⏳ |  |
| 金刚日程管理 | ⏳ |  |
| 默认模式 | ⏳ |  |
| 切换鹦鹉 | ⏳ |  |
| 多轮对话 | ⏳ |  |

---

**准备就绪！** 开发服务器运行中，编译成功，可以开始测试。

**下一步**: 打开浏览器访问 http://localhost:25173，按照上述清单逐项测试。

