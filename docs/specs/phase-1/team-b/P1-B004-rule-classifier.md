# P1-B004: è§„åˆ™åˆ†ç±»å™¨æ‰©å±•

> **çŠ¶æ€**: ğŸ”² å¾…å¼€å‘  
> **ä¼˜å…ˆçº§**: P0 (æ ¸å¿ƒ)  
> **æŠ•å…¥**: 2 äººå¤©  
> **è´Ÿè´£å›¢é˜Ÿ**: å›¢é˜Ÿ B  
> **Sprint**: Sprint 2

---

## 1. ç›®æ ‡ä¸èƒŒæ™¯

### 1.1 æ ¸å¿ƒç›®æ ‡

åŸºäºå›¢é˜Ÿ A çš„ RouterServiceï¼Œåœ¨æ—¥ç¨‹ Agent å±‚é¢æ‰©å±•è§„åˆ™åˆ†ç±»å™¨ï¼Œè¦†ç›– 90%+ æ—¥ç¨‹ç›¸å…³åœºæ™¯ã€‚

### 1.2 ç”¨æˆ·ä»·å€¼

- æ—¥ç¨‹æ„å›¾è¯†åˆ«æ›´å‡†ç¡®
- å“åº”å»¶è¿Ÿé™ä½ 300ms+

### 1.3 æŠ€æœ¯ä»·å€¼

- å‡å°‘ LLM è°ƒç”¨ 70%+
- ä¸ RouterService ååŒå·¥ä½œ

---

## 2. ä¾èµ–å…³ç³»

### 2.1 å‰ç½®ä¾èµ–

- [ ] P1-A003: LLM è·¯ç”±ä¼˜åŒ–ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰

### 2.2 å¹¶è¡Œä¾èµ–

- P1-B003: æ—¶é—´è§£æåŠ å›º

### 2.3 åç»­ä¾èµ–

- P2-B001: ç”¨æˆ·ä¹ æƒ¯å­¦ä¹ 

---

## 3. åŠŸèƒ½è®¾è®¡

### 3.1 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ—¥ç¨‹è§„åˆ™åˆ†ç±»å™¨                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç”¨æˆ·è¾“å…¥                                                        â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è§„åˆ™åŒ¹é… (0ms)                                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ åˆ›å»ºæ¨¡å¼                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ (æ—¶é—´è¯) + (åŠ¨ä½œ/äº‹ä»¶)                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "æ˜å¤©3ç‚¹å¼€ä¼š" â†’ SimpleCreate                       â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "å®‰æ’ä¸‹å‘¨ä¸€é¢è¯•" â†’ SimpleCreate                    â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ æŸ¥è¯¢æ¨¡å¼                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ (ç–‘é—®è¯) + (æ—¶é—´)                                  â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "ä»Šå¤©æœ‰ä»€ä¹ˆå®‰æ’" â†’ SimpleQuery                     â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "æ˜å¤©å‡ ç‚¹æœ‰ä¼š" â†’ SimpleQuery                       â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ ä¿®æ”¹æ¨¡å¼                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ (ä¿®æ”¹åŠ¨è¯) + (ç›®æ ‡)                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "æŠŠä¼šè®®æ”¹åˆ°3ç‚¹" â†’ SimpleUpdate                     â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "å–æ¶ˆæ˜å¤©çš„ä¼š" â†’ SimpleUpdate                      â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ æ‰¹é‡æ¨¡å¼                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ (é‡å¤å…³é”®è¯)                                       â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "æ¯å‘¨ä¸€ç«™ä¼š" â†’ BatchCreate                         â”‚â”‚   â”‚
â”‚  â”‚  â”‚   "å·¥ä½œæ—¥æ—©ä¸Š9ç‚¹" â†’ BatchCreate                      â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  æœªåŒ¹é… â†’ è°ƒç”¨ RouterService.ClassifyIntent()                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒæµç¨‹

1. **æ¨¡å¼åŒ¹é…**: å°è¯•è§„åˆ™åŒ¹é…
2. **å…œåº•è·¯ç”±**: æœªåŒ¹é…æ—¶è°ƒç”¨ RouterService

### 3.3 å…³é”®è¯åº“

| æ„å›¾ | é«˜æƒé‡å…³é”®è¯ | ä½æƒé‡å…³é”®è¯ | è§¦å‘é˜ˆå€¼ |
|:---|:---|:---|:---:|
| SimpleCreate | å®‰æ’/çº¦/é¢„çº¦/ä¼šè®®/å¼€ä¼š/é¢è¯• | æ—¶é—´è¯ | >= 3 |
| SimpleQuery | ä»€ä¹ˆå®‰æ’/æœ‰ä»€ä¹ˆ/å¿™å—/æœ‰ç©º/å‡ ç‚¹ | æ—¶é—´è¯ | >= 2 |
| SimpleUpdate | æ”¹/æ¢/è°ƒ/æ¨è¿Ÿ/æå‰/å–æ¶ˆ/åˆ é™¤ | ä¼šè®®/æ—¥ç¨‹ | >= 2 |
| BatchCreate | æ¯å¤©/æ¯å‘¨/æ¯æœˆ/å·¥ä½œæ—¥/å‘¨ä¸€åˆ°å‘¨äº” | - | >= 1 |

---

## 4. æŠ€æœ¯å®ç°

### 4.1 å…³é”®ä»£ç è·¯å¾„

| æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|:---|:---|
| `plugin/ai/schedule/intent_classifier.go` | æ„å›¾åˆ†ç±»å™¨ |

### 4.2 æ ¸å¿ƒå®ç°

```go
// plugin/ai/schedule/intent_classifier.go

type TaskIntent int

const (
    IntentUnknown TaskIntent = iota
    IntentSimpleCreate
    IntentSimpleQuery
    IntentSimpleUpdate
    IntentBatchCreate
)

type IntentClassifier struct {
    routerService router.RouterService
    patterns      []intentPattern
}

type intentPattern struct {
    regex  *regexp.Regexp
    intent TaskIntent
}

func NewIntentClassifier(routerService router.RouterService) *IntentClassifier {
    return &IntentClassifier{
        routerService: routerService,
        patterns: []intentPattern{
            // åˆ›å»º: æ—¶é—´ + åŠ¨ä½œ/äº‹ä»¶
            {regexp.MustCompile(`(æ˜å¤©|åå¤©|ä¸‹å‘¨|ä»Šå¤©).*(ç‚¹|æ—¶).*(å¼€ä¼š|ä¼šè®®|é¢è¯•|çº¦|è§)`), IntentSimpleCreate},
            {regexp.MustCompile(`(ä¸Šåˆ|ä¸‹åˆ|æ™šä¸Š|æ—©ä¸Š).*(å®‰æ’|çº¦|é¢„çº¦)`), IntentSimpleCreate},
            {regexp.MustCompile(`å®‰æ’.*(ä¼šè®®|é¢è¯•|çº¦ä¼š)`), IntentSimpleCreate},
            
            // æŸ¥è¯¢: ç–‘é—®è¯ + æ—¶é—´
            {regexp.MustCompile(`(ä»Šå¤©|æ˜å¤©|è¿™å‘¨|ä¸‹å‘¨).*(æœ‰ä»€ä¹ˆ|ä»€ä¹ˆå®‰æ’|å¿™å—|æœ‰ç©º)`), IntentSimpleQuery},
            {regexp.MustCompile(`(æŸ¥|çœ‹|æ˜¾ç¤º).*(æ—¥ç¨‹|å®‰æ’|è®¡åˆ’)`), IntentSimpleQuery},
            {regexp.MustCompile(`(å‡ ç‚¹|ä»€ä¹ˆæ—¶å€™).*(ä¼š|å¼€å§‹)`), IntentSimpleQuery},
            
            // ä¿®æ”¹: ä¿®æ”¹åŠ¨è¯ + ç›®æ ‡
            {regexp.MustCompile(`(æ”¹|æ¢|è°ƒ|æ¨è¿Ÿ|æå‰|å–æ¶ˆ|åˆ é™¤).*(ä¼šè®®|æ—¥ç¨‹|å®‰æ’)`), IntentSimpleUpdate},
            {regexp.MustCompile(`æŠŠ.*(æ”¹|æ¢|è°ƒ)åˆ°`), IntentSimpleUpdate},
            
            // æ‰¹é‡: é‡å¤å…³é”®è¯
            {regexp.MustCompile(`æ¯(å¤©|å‘¨|æœˆ|å¹´)|å·¥ä½œæ—¥|å‘¨ä¸€åˆ°å‘¨äº”`), IntentBatchCreate},
        },
    }
}

// Classify åˆ†ç±»ç”¨æˆ·æ„å›¾
func (ic *IntentClassifier) Classify(ctx context.Context, input string) (TaskIntent, float32) {
    lowerInput := strings.ToLower(input)
    
    // è§„åˆ™åŒ¹é…
    for _, p := range ic.patterns {
        if p.regex.MatchString(lowerInput) {
            return p.intent, 0.9 // é«˜ç½®ä¿¡åº¦
        }
    }
    
    // å…œåº•: æœ‰æ—¶é—´è¯+åŠ¨ä½œè¯ â†’ åˆ›å»º
    if ic.hasTimeAndAction(lowerInput) {
        return IntentSimpleCreate, 0.7
    }
    
    // è°ƒç”¨ RouterService
    intent, confidence, err := ic.routerService.ClassifyIntent(ctx, input)
    if err != nil {
        return IntentUnknown, 0
    }
    
    return ic.mapRouterIntent(intent), confidence
}

// hasTimeAndAction æ£€æŸ¥æ˜¯å¦æœ‰æ—¶é—´è¯å’ŒåŠ¨ä½œè¯
func (ic *IntentClassifier) hasTimeAndAction(input string) bool {
    timeWords := []string{"ä»Šå¤©", "æ˜å¤©", "åå¤©", "ä¸‹å‘¨", "ç‚¹", "æ—¶"}
    actionWords := []string{"å¼€ä¼š", "ä¼šè®®", "é¢è¯•", "çº¦", "å®‰æ’"}
    
    hasTime := false
    hasAction := false
    
    for _, w := range timeWords {
        if strings.Contains(input, w) {
            hasTime = true
            break
        }
    }
    
    for _, w := range actionWords {
        if strings.Contains(input, w) {
            hasAction = true
            break
        }
    }
    
    return hasTime && hasAction
}
```

---

## 5. äº¤ä»˜ç‰©æ¸…å•

### 5.1 ä»£ç æ–‡ä»¶

- [ ] `plugin/ai/schedule/intent_classifier.go` - æ„å›¾åˆ†ç±»å™¨

### 5.2 æµ‹è¯•æ–‡ä»¶

- [ ] `plugin/ai/schedule/intent_classifier_test.go`

---

## 6. æµ‹è¯•éªŒæ”¶

### 6.1 åŠŸèƒ½æµ‹è¯•

| åœºæ™¯ | è¾“å…¥ | é¢„æœŸè¾“å‡º |
|:---|:---|:---|
| ç®€å•åˆ›å»º | "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š" | IntentSimpleCreate |
| ç®€å•æŸ¥è¯¢ | "ä»Šå¤©æœ‰ä»€ä¹ˆå®‰æ’" | IntentSimpleQuery |
| ç®€å•ä¿®æ”¹ | "æŠŠä¼šè®®æ”¹åˆ°4ç‚¹" | IntentSimpleUpdate |
| æ‰¹é‡åˆ›å»º | "æ¯å‘¨ä¸€9ç‚¹ç«™ä¼š" | IntentBatchCreate |

### 6.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|:---|:---|:---|
| è§„åˆ™è¦†ç›–ç‡ | > 90% | æµ‹è¯•ç”¨ä¾‹é›† |
| åˆ†ç±»å»¶è¿Ÿ | < 10ms | å•å…ƒæµ‹è¯• |

---

## 7. ROI åˆ†æ

| ç»´åº¦ | å€¼ |
|:---|:---|
| å¼€å‘æŠ•å…¥ | 2 äººå¤© |
| é¢„æœŸæ”¶ç›Š | LLM è°ƒç”¨ -70%ï¼Œå»¶è¿Ÿ -300ms |
| é£é™©è¯„ä¼° | ä½ |
| å›æŠ¥å‘¨æœŸ | Phase 1 ç»“æŸ |

---

## 8. å®æ–½è®¡åˆ’

### 8.1 æ—¶é—´è¡¨

| é˜¶æ®µ | æ—¶é—´ | ä»»åŠ¡ |
|:---|:---|:---|
| Day 1 | 1äººå¤© | è§„åˆ™æ¨¡å¼å®ç° |
| Day 2 | 1äººå¤© | æµ‹è¯•ç”¨ä¾‹ + è°ƒä¼˜ |

### 8.2 æ£€æŸ¥ç‚¹

- [ ] Day 1: æ ¸å¿ƒè§„åˆ™å®Œæˆ
- [ ] Day 2: è¦†ç›–ç‡ > 90%

---

## é™„å½•

### A. å‚è€ƒèµ„æ–™

- [æ—¥ç¨‹è·¯çº¿å›¾ - è§„åˆ™åˆ†ç±»å™¨](../../research/schedule-roadmap.md)
- [ChatRouter ç°æœ‰å®ç°](../../../plugin/ai/agent/chat_router.go)

### B. å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|:---|:---|:---|:---|
| 2026-01-27 | v1.0 | åˆå§‹ç‰ˆæœ¬ | - |
