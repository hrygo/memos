# P1-A004: æ—¶é—´è§£ææœåŠ¡

> **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­  
> **ä¼˜å…ˆçº§**: P0 (æ ¸å¿ƒ)  
> **æŠ•å…¥**: 2 äººå¤©  
> **è´Ÿè´£å›¢é˜Ÿ**: å›¢é˜Ÿ A  
> **Sprint**: Sprint 2

---

## 1. ç›®æ ‡ä¸èƒŒæ™¯

### 1.1 æ ¸å¿ƒç›®æ ‡

å®ç°ç»Ÿä¸€æ—¶é—´è§£ææœåŠ¡ï¼Œæ”¯æŒå¤šç§ä¸­æ–‡è‡ªç„¶è¯­è¨€æ—¶é—´è¡¨è¾¾ï¼ŒæˆåŠŸç‡ >98%ã€‚

### 1.2 ç”¨æˆ·ä»·å€¼

- è‡ªç„¶è¯­è¨€åˆ›å»ºæ—¥ç¨‹æ›´å¯é 
- æ—¶é—´è§£æä¸å†å‡ºé”™

### 1.3 æŠ€æœ¯ä»·å€¼

- ç»Ÿä¸€æ—¶é—´è§£æä¾›å›¢é˜Ÿ B è°ƒç”¨
- ä¸ºæ—¥ç¨‹ç®¡ç†æä¾›å¯é åŸºç¡€

---

## 2. ä¾èµ–å…³ç³»

### 2.1 å‰ç½®ä¾èµ–

- [x] S0-interface-contract: æ¥å£å®šä¹‰

### 2.2 å¹¶è¡Œä¾èµ–

- P1-A005: ç¼“å­˜å±‚ï¼ˆå¯å¹¶è¡Œï¼‰

### 2.3 åç»­ä¾èµ–

- P1-B003: æ—¶é—´è§£æåŠ å›º
- P2-B002: å¿«é€Ÿåˆ›å»ºæ¨¡å¼
- P3-B002: ä¸»åŠ¨æé†’ç³»ç»Ÿ

---

## 3. åŠŸèƒ½è®¾è®¡

### 3.1 æ”¯æŒçš„æ—¶é—´è¡¨è¾¾

| ç±»åˆ« | ç¤ºä¾‹ | è§£æç»“æœ |
|:---|:---|:---|
| ç›¸å¯¹æ—¥æœŸ | ä»Šå¤©/æ˜å¤©/åå¤©/å¤§åå¤© | å¯¹åº”æ—¥æœŸ |
| æ˜ŸæœŸ | å‘¨ä¸€/ä¸‹å‘¨ä¸‰/ä¸Šå‘¨äº” | å¯¹åº”æ—¥æœŸ |
| æ—¶é—´ | 3ç‚¹/ä¸‹åˆ3ç‚¹/15:00 | å¯¹åº”æ—¶é—´ |
| æ—¶æ®µ | æ—©ä¸Š/ä¸Šåˆ/ä¸­åˆ/ä¸‹åˆ/æ™šä¸Š | æ—¶é—´èŒƒå›´ |
| ç»„åˆ | æ˜å¤©ä¸‹åˆ3ç‚¹ | å®Œæ•´æ—¶é—´ |
| ç›¸å¯¹æ—¶é—´ | 1å°æ—¶å/30åˆ†é’Ÿå | è®¡ç®—åæ—¶é—´ |

### 3.2 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ—¶é—´è§£ææœåŠ¡                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  è¾“å…¥: "æ˜å¤©ä¸‹åˆ3ç‚¹" + timezone                                  â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Step 1: æ ‡å‡†æ ¼å¼å°è¯•                                     â”‚   â”‚
â”‚  â”‚  â€¢ RFC3339: 2026-01-28T15:00:00+08:00                    â”‚   â”‚
â”‚  â”‚  â€¢ ISO æ ¼å¼: 2026-01-28 15:00                            â”‚   â”‚
â”‚  â”‚  â€¢ å¸¸è§æ ¼å¼: 2026/1/28, 2026å¹´1æœˆ28æ—¥                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚ å¤±è´¥                                â”‚
â”‚                           â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Step 2: è‡ªç„¶è¯­è¨€è§£æ (è§„åˆ™é©±åŠ¨)                          â”‚   â”‚
â”‚  â”‚  â€¢ ç›¸å¯¹æ—¥æœŸè§£æ: ä»Šå¤©/æ˜å¤©/åå¤©...                        â”‚   â”‚
â”‚  â”‚  â€¢ æ˜ŸæœŸè§£æ: å‘¨ä¸€/ä¸‹å‘¨ä¸‰...                               â”‚   â”‚
â”‚  â”‚  â€¢ æ—¶é—´è§£æ: 3ç‚¹/ä¸‹åˆ3ç‚¹/15:00...                        â”‚   â”‚
â”‚  â”‚  â€¢ ç»„åˆ: æ—¥æœŸ + æ—¶é—´                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚  è¾“å‡º: time.Time (æ ‡å‡†åŒ–)                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å…³é”®å†³ç­–

| å†³ç­–ç‚¹ | æ–¹æ¡ˆ A | æ–¹æ¡ˆ B | é€‰æ‹© | ç†ç”± |
|:---|:---|:---|:---:|:---|
| è§£ææ–¹å¼ | LLM | è§„åˆ™ | B | å»¶è¿Ÿä½ï¼Œæˆæœ¬ä½ |
| æ—¶åŒºå¤„ç† | UTC | ç”¨æˆ·æ—¶åŒº | B | ç”¨æˆ·ä½“éªŒä¼˜å…ˆ |

---

## 4. æŠ€æœ¯å®ç°

### 4.1 æ¥å£å®šä¹‰

è§ [S0-interface-contract](../sprint-0/S0-interface-contract.md)

### 4.2 å…³é”®ä»£ç è·¯å¾„

| æ–‡ä»¶è·¯å¾„ | èŒè´£ |
|:---|:---|
| `plugin/ai/time/service.go` | æ—¶é—´æœåŠ¡ä¸»å®ç° |
| `plugin/ai/time/normalizer.go` | æ—¶é—´æ ‡å‡†åŒ– |
| `plugin/ai/time/parser.go` | è‡ªç„¶è¯­è¨€è§£æ |
| `plugin/ai/time/patterns.go` | æ­£åˆ™æ¨¡å¼å®šä¹‰ |

### 4.3 è§£æè§„åˆ™å®ç°

```go
// plugin/ai/time/parser.go

type TimeParser struct {
    now      func() time.Time
    timezone *time.Location
    
    // é¢„ç¼–è¯‘æ­£åˆ™
    relDateRe    *regexp.Regexp  // ä»Šå¤©|æ˜å¤©|åå¤©|å¤§åå¤©
    weekdayRe    *regexp.Regexp  // å‘¨ä¸€|å‘¨äºŒ|...|å‘¨æ—¥
    nextWeekRe   *regexp.Regexp  // ä¸‹å‘¨ä¸€|ä¸‹å‘¨äºŒ|...
    timeRe       *regexp.Regexp  // 3ç‚¹|15:00|ä¸‹åˆ3ç‚¹
    periodRe     *regexp.Regexp  // æ—©ä¸Š|ä¸Šåˆ|ä¸­åˆ|ä¸‹åˆ|æ™šä¸Š
}

var relDateMap = map[string]int{
    "ä»Šå¤©": 0, "æ˜å¤©": 1, "åå¤©": 2, "å¤§åå¤©": 3,
    "æ˜¨å¤©": -1, "å‰å¤©": -2,
}

var periodMap = map[string][2]int{
    "æ—©ä¸Š": {6, 9}, "ä¸Šåˆ": {9, 12}, "ä¸­åˆ": {12, 14},
    "ä¸‹åˆ": {14, 18}, "æ™šä¸Š": {18, 22}, "å¤œé—´": {22, 6},
}

func (p *TimeParser) Parse(input string) (time.Time, error) {
    // 1. è§£ææ—¥æœŸéƒ¨åˆ†
    date := p.parseDate(input)
    
    // 2. è§£ææ—¶é—´éƒ¨åˆ†
    hour, minute := p.parseTime(input)
    
    // 3. ç»„åˆ
    return time.Date(
        date.Year(), date.Month(), date.Day(),
        hour, minute, 0, 0,
        p.timezone,
    ), nil
}
```

---

## 5. äº¤ä»˜ç‰©æ¸…å•

### 5.1 ä»£ç æ–‡ä»¶

- [ ] `plugin/ai/time/service.go` - æ—¶é—´æœåŠ¡ä¸»å®ç°
- [ ] `plugin/ai/time/normalizer.go` - æ ¼å¼æ ‡å‡†åŒ–
- [ ] `plugin/ai/time/parser.go` - è‡ªç„¶è¯­è¨€è§£æ
- [ ] `plugin/ai/time/patterns.go` - æ­£åˆ™æ¨¡å¼

### 5.2 æµ‹è¯•æ–‡ä»¶

- [ ] `plugin/ai/time/service_test.go`
- [ ] `plugin/ai/time/parser_test.go`

---

## 6. æµ‹è¯•éªŒæ”¶

### 6.1 åŠŸèƒ½æµ‹è¯•

| åœºæ™¯ | è¾“å…¥ | é¢„æœŸè¾“å‡º |
|:---|:---|:---|
| ç›¸å¯¹æ—¥æœŸ | "æ˜å¤©" | tomorrow's date |
| å®Œæ•´æ—¶é—´ | "æ˜å¤©ä¸‹åˆ3ç‚¹" | tomorrow 15:00 |
| æ ‡å‡†æ ¼å¼ | "2026-01-28T15:00:00" | parsed time |
| ç›¸å¯¹æ—¶é—´ | "1å°æ—¶å" | now + 1h |

### 6.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|:---|:---|:---|
| è§£æå»¶è¿Ÿ | < 10ms | å•å…ƒæµ‹è¯• |
| æˆåŠŸç‡ | > 98% | æµ‹è¯•ç”¨ä¾‹é›† |

---

## 7. ROI åˆ†æ

| ç»´åº¦ | å€¼ |
|:---|:---|
| å¼€å‘æŠ•å…¥ | 2 äººå¤© |
| é¢„æœŸæ”¶ç›Š | æ—¶é—´è§£ææˆåŠŸç‡ +13%ï¼ˆä» 85% åˆ° 98%ï¼‰ |
| é£é™©è¯„ä¼° | ä½ |
| å›æŠ¥å‘¨æœŸ | Phase 1 ç»“æŸ |

---

## 8. å®æ–½è®¡åˆ’

### 8.1 æ—¶é—´è¡¨

| é˜¶æ®µ | æ—¶é—´ | ä»»åŠ¡ |
|:---|:---|:---|
| Day 1 | 1äººå¤© | è§£æå™¨å®ç° |
| Day 2 | 1äººå¤© | æµ‹è¯•ç”¨ä¾‹ + è¾¹ç•Œå¤„ç† |

### 8.2 æ£€æŸ¥ç‚¹

- [ ] Day 1: æ ¸å¿ƒè§£æåŠŸèƒ½å®Œæˆ
- [ ] Day 2: æµ‹è¯•è¦†ç›–ç‡ > 90%

---

## é™„å½•

### A. å‚è€ƒèµ„æ–™

- [æ—¥ç¨‹è·¯çº¿å›¾ - æ—¶é—´è§£æ](../../research/schedule-roadmap.md)
- [QueryEngine ç°æœ‰å®ç°](../../../server/queryengine/query_router.go)

### B. å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|:---|:---|:---|:---|
| 2026-01-27 | v1.0 | åˆå§‹ç‰ˆæœ¬ | - |
