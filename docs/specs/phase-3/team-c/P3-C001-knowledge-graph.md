# P3-C001: çŸ¥è¯†å›¾è°±å¯è§†åŒ–

> **çŠ¶æ€**: ğŸ”² å¾…å¼€å‘  
> **ä¼˜å…ˆçº§**: P3 (å¯é€‰)  
> **æŠ•å…¥**: 13 äººå¤© (Sprint 5: 8å¤© + Sprint 6: 5å¤©)  
> **è´Ÿè´£å›¢é˜Ÿ**: å›¢é˜Ÿ C  
> **Sprint**: Sprint 5-6

---

## 1. ç›®æ ‡ä¸èƒŒæ™¯

### 1.1 æ ¸å¿ƒç›®æ ‡

æ„å»ºç¬”è®°çŸ¥è¯†å›¾è°±ï¼Œå¯è§†åŒ–ç¬”è®°ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œæ”¯æŒå›¾è°±æ¢ç´¢å’ŒçŸ¥è¯†å‘ç°ã€‚

### 1.2 ç”¨æˆ·ä»·å€¼

- å‘ç°éšè—çš„çŸ¥è¯†å…³è”
- å¯è§†åŒ–ä¸ªäººçŸ¥è¯†ä½“ç³»
- æ›´å¥½çš„çŸ¥è¯†ç®¡ç†ä½“éªŒ

---

## 2. ä¾èµ–å…³ç³»

- [x] P1-A005: é€šç”¨ç¼“å­˜å±‚
- [x] P1-C003: ç›¸å…³ç¬”è®°æ¨è
- [x] P2-C002: é‡å¤æ£€æµ‹ç³»ç»Ÿ

---

## 3. åŠŸèƒ½è®¾è®¡

### 3.1 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŸ¥è¯†å›¾è°±æ¶æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  æ•°æ®å±‚                                                     â”‚
â”‚  â”œâ”€ èŠ‚ç‚¹: ç¬”è®° (Memo)                                      â”‚
â”‚  â”œâ”€ è¾¹: å…³è”å…³ç³»                                           â”‚
â”‚  â”‚   â”œâ”€ æ˜¾å¼é“¾æ¥ (ç”¨æˆ·åˆ›å»º)                                â”‚
â”‚  â”‚   â”œâ”€ æ ‡ç­¾å…±ç°                                           â”‚
â”‚  â”‚   â””â”€ è¯­ä¹‰ç›¸ä¼¼                                           â”‚
â”‚  â””â”€ å±æ€§: æ ‡ç­¾ã€æ—¶é—´ã€é‡è¦æ€§                               â”‚
â”‚                                                            â”‚
â”‚  è®¡ç®—å±‚                                                     â”‚
â”‚  â”œâ”€ å›¾è°±æ„å»º: å¢é‡æ›´æ–°                                     â”‚
â”‚  â”œâ”€ ç¤¾åŒºå‘ç°: Louvain ç®—æ³•                                 â”‚
â”‚  â””â”€ ä¸­å¿ƒæ€§è®¡ç®—: PageRank                                   â”‚
â”‚                                                            â”‚
â”‚  å±•ç¤ºå±‚                                                     â”‚
â”‚  â”œâ”€ åŠ›å¯¼å‘å›¾ (D3.js / Cytoscape.js)                       â”‚
â”‚  â”œâ”€ äº¤äº’: ç¼©æ”¾ã€æ‹–æ‹½ã€èšç„¦                                 â”‚
â”‚  â””â”€ ç­›é€‰: æŒ‰æ ‡ç­¾ã€æ—¶é—´ã€é‡è¦æ€§                             â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å›¾è°±æ•°æ®æ¨¡å‹

```go
// plugin/ai/graph/model.go

type GraphNode struct {
    ID         string            `json:"id"`
    Label      string            `json:"label"`      // ç¬”è®°æ ‡é¢˜
    Type       string            `json:"type"`       // memo, tag
    Tags       []string          `json:"tags"`
    Importance float64           `json:"importance"` // PageRank
    Cluster    int               `json:"cluster"`    // ç¤¾åŒºID
    CreatedAt  time.Time         `json:"created_at"`
}

type GraphEdge struct {
    Source   string  `json:"source"`
    Target   string  `json:"target"`
    Type     string  `json:"type"`     // link, tag_co, semantic
    Weight   float64 `json:"weight"`
}

type KnowledgeGraph struct {
    Nodes []GraphNode `json:"nodes"`
    Edges []GraphEdge `json:"edges"`
}
```

### 3.3 å›¾è°±æ„å»º

```go
// plugin/ai/graph/builder.go

type GraphBuilder struct {
    memoStore    MemoStore
    vectorStore  VectorStore
    cache        CacheService
}

func (b *GraphBuilder) Build(ctx context.Context, userID int32) (*KnowledgeGraph, error) {
    // ç¼“å­˜æ£€æŸ¥
    cacheKey := fmt.Sprintf("graph:%d", userID)
    if cached, ok := b.cache.Get(cacheKey); ok {
        return cached.(*KnowledgeGraph), nil
    }
    
    graph := &KnowledgeGraph{}
    
    // 1. è·å–æ‰€æœ‰ç¬”è®°ä½œä¸ºèŠ‚ç‚¹
    memos, _ := b.memoStore.GetAllMemos(ctx, userID)
    for _, memo := range memos {
        graph.Nodes = append(graph.Nodes, GraphNode{
            ID:        memo.ID,
            Label:     extractTitle(memo.Content),
            Type:      "memo",
            Tags:      memo.Tags,
            CreatedAt: memo.CreatedAt,
        })
    }
    
    // 2. æ„å»ºè¾¹
    // 2.1 æ˜¾å¼é“¾æ¥
    links, _ := b.memoStore.GetAllLinks(ctx, userID)
    for _, link := range links {
        graph.Edges = append(graph.Edges, GraphEdge{
            Source: link.SourceID,
            Target: link.TargetID,
            Type:   "link",
            Weight: 1.0,
        })
    }
    
    // 2.2 æ ‡ç­¾å…±ç°
    tagEdges := b.buildTagCoOccurrenceEdges(memos)
    graph.Edges = append(graph.Edges, tagEdges...)
    
    // 2.3 è¯­ä¹‰ç›¸ä¼¼ (Top-3)
    semanticEdges := b.buildSemanticEdges(ctx, memos)
    graph.Edges = append(graph.Edges, semanticEdges...)
    
    // 3. è®¡ç®—ä¸­å¿ƒæ€§
    b.computeImportance(graph)
    
    // 4. ç¤¾åŒºå‘ç°
    b.detectCommunities(graph)
    
    // ç¼“å­˜ 10 åˆ†é’Ÿ
    b.cache.Set(cacheKey, graph, 10*time.Minute)
    
    return graph, nil
}
```

### 3.4 å‰ç«¯å¯è§†åŒ–

```tsx
// web/src/components/graph/KnowledgeGraphView.tsx

import { useEffect, useRef } from 'react';
import * as d3 from 'd3';

export function KnowledgeGraphView({ graph }: { graph: KnowledgeGraph }) {
  const svgRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    if (!svgRef.current || !graph) return;

    const svg = d3.select(svgRef.current);
    const width = 800;
    const height = 600;

    // åŠ›å¯¼å‘æ¨¡æ‹Ÿ
    const simulation = d3.forceSimulation(graph.nodes)
      .force('link', d3.forceLink(graph.edges).id(d => d.id))
      .force('charge', d3.forceManyBody().strength(-100))
      .force('center', d3.forceCenter(width / 2, height / 2));

    // ç»˜åˆ¶è¾¹
    const links = svg.selectAll('line')
      .data(graph.edges)
      .join('line')
      .attr('stroke', '#999')
      .attr('stroke-opacity', d => d.weight);

    // ç»˜åˆ¶èŠ‚ç‚¹
    const nodes = svg.selectAll('circle')
      .data(graph.nodes)
      .join('circle')
      .attr('r', d => 5 + d.importance * 10)
      .attr('fill', d => colorByCluster(d.cluster))
      .call(drag(simulation));

    // æ ‡ç­¾
    const labels = svg.selectAll('text')
      .data(graph.nodes)
      .join('text')
      .text(d => d.label)
      .attr('font-size', 10);

    simulation.on('tick', () => {
      links
        .attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y);

      nodes
        .attr('cx', d => d.x)
        .attr('cy', d => d.y);

      labels
        .attr('x', d => d.x + 8)
        .attr('y', d => d.y + 3);
    });
  }, [graph]);

  return <svg ref={svgRef} width={800} height={600} />;
}
```

---

## 4. å®ç°è·¯å¾„

| Sprint | Day | ä»»åŠ¡ |
|--------|-----|------|
| 5 | 1-2 | å›¾è°±æ•°æ®æ¨¡å‹ |
| 5 | 3-4 | è¾¹æ„å»ºï¼ˆé“¾æ¥ã€æ ‡ç­¾ã€è¯­ä¹‰ï¼‰ |
| 5 | 5-6 | ä¸­å¿ƒæ€§ä¸ç¤¾åŒºå‘ç° |
| 5 | 7-8 | API ä¸ç¼“å­˜ |
| 6 | 1-2 | å‰ç«¯ D3 å¯è§†åŒ– |
| 6 | 3-4 | äº¤äº’ï¼ˆç¼©æ”¾ã€ç­›é€‰ï¼‰ |
| 6 | 5 | æµ‹è¯•ä¸ä¼˜åŒ– |

---

## 5. éªŒæ”¶æ ‡å‡†

- [ ] å›¾è°±æ­£ç¡®æ˜¾ç¤ºç¬”è®°èŠ‚ç‚¹
- [ ] ä¸‰ç§è¾¹ç±»å‹æ­£ç¡®æ¸²æŸ“
- [ ] æ”¯æŒç¼©æ”¾ã€æ‹–æ‹½
- [ ] èŠ‚ç‚¹ç‚¹å‡»è·³è½¬ç¬”è®°

---

> **ç‰ˆæœ¬**: v1.0 | **æ›´æ–°æ—¶é—´**: 2026-01-27
