# P3-B001: é¢„æµ‹æ€§äº¤äº’ç³»ç»Ÿ

> **çŠ¶æ€**: ðŸ”² å¾…å¼€å‘  
> **ä¼˜å…ˆçº§**: P2 (å¢žå¼º)  
> **æŠ•å…¥**: 5 äººå¤©  
> **è´Ÿè´£å›¢é˜Ÿ**: å›¢é˜Ÿ B  
> **Sprint**: Sprint 5

---

## 1. ç›®æ ‡ä¸ŽèƒŒæ™¯

### 1.1 æ ¸å¿ƒç›®æ ‡

åŸºäºŽç”¨æˆ·ä¹ æƒ¯å’Œä¸Šä¸‹æ–‡ï¼Œé¢„æµ‹ç”¨æˆ·ä¸‹ä¸€æ­¥æ“ä½œï¼Œä¸»åŠ¨æä¾›å¿«æ·å…¥å£ï¼Œå®žçŽ°"æ¯”ç”¨æˆ·æ›´å¿«ä¸€æ­¥"çš„ä½“éªŒã€‚

### 1.2 ç”¨æˆ·ä»·å€¼

- å‡å°‘æ“ä½œæ­¥éª¤ 40%
- æ›´æ™ºèƒ½çš„åŠ©ç†ä½“éªŒ
- "æ‡‚æˆ‘"çš„ç§äººåŠ©ç†

---

## 2. ä¾èµ–å…³ç³»

- [x] P1-A001: è½»é‡è®°å¿†ç³»ç»Ÿ
- [x] P2-B001: ç”¨æˆ·ä¹ æƒ¯å­¦ä¹ 

---

## 3. åŠŸèƒ½è®¾è®¡

### 3.1 é¢„æµ‹åœºæ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¢„æµ‹æ€§äº¤äº’åœºæ™¯                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  åœºæ™¯ 1: æ—¶é—´è§¦å‘                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  å‘¨ä¸€æ—©ä¸Š 9:00 â†’ é¢„æµ‹"åˆ›å»ºæœ¬å‘¨ä¼šè®®"                        â”‚
â”‚  ä¸‹ç­å‰ 17:30 â†’ é¢„æµ‹"æ˜Žå¤©æ—¥ç¨‹é¢„è§ˆ"                         â”‚
â”‚                                                            â”‚
â”‚  åœºæ™¯ 2: ä¸Šä¸‹æ–‡è§¦å‘                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  åˆšåˆ›å»ºæ—¥ç¨‹ â†’ é¢„æµ‹"è®¾ç½®æé†’"                               â”‚
â”‚  æŸ¥çœ‹ç¬”è®°åŽ â†’ é¢„æµ‹"æœç´¢ç›¸å…³ç¬”è®°"                           â”‚
â”‚                                                            â”‚
â”‚  åœºæ™¯ 3: æ¨¡å¼è§¦å‘                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  æ¯å‘¨ä¸€æŸ¥çœ‹å‘¨æŠ¥ â†’ ä¸»åŠ¨æŽ¨é€å‘¨æŠ¥å…¥å£                         â”‚
â”‚  æœˆåº•æ•´ç†ç¬”è®° â†’ æç¤º"æœ¬æœˆç¬”è®°å›žé¡¾"                         â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒå®žçŽ°

```go
// plugin/ai/prediction/engine.go

type PredictionEngine struct {
    habitService  *HabitAnalyzer
    memoryService MemoryService
    timeService   TimeService
}

type Prediction struct {
    Type       string  `json:"type"`        // "action", "query", "reminder"
    Label      string  `json:"label"`       // æ˜¾ç¤ºæ–‡æœ¬
    Confidence float64 `json:"confidence"`
    Action     string  `json:"action"`      // è§¦å‘çš„åŠ¨ä½œ
    Payload    any     `json:"payload"`
}

func (e *PredictionEngine) Predict(ctx context.Context, userID int32) ([]Prediction, error) {
    var predictions []Prediction
    
    // 1. æ—¶é—´è§¦å‘é¢„æµ‹
    timePredictions := e.predictByTime(ctx, userID)
    predictions = append(predictions, timePredictions...)
    
    // 2. ä¸Šä¸‹æ–‡è§¦å‘é¢„æµ‹
    contextPredictions := e.predictByContext(ctx, userID)
    predictions = append(predictions, contextPredictions...)
    
    // 3. æ¨¡å¼è§¦å‘é¢„æµ‹
    patternPredictions := e.predictByPattern(ctx, userID)
    predictions = append(predictions, patternPredictions...)
    
    // æŽ’åºå¹¶è¿”å›ž Top-3
    sort.Slice(predictions, func(i, j int) bool {
        return predictions[i].Confidence > predictions[j].Confidence
    })
    
    if len(predictions) > 3 {
        predictions = predictions[:3]
    }
    
    return predictions, nil
}

func (e *PredictionEngine) predictByTime(ctx context.Context, userID int32) []Prediction {
    now := time.Now()
    var predictions []Prediction
    
    // å‘¨ä¸€æ—©ä¸Š â†’ æœ¬å‘¨ä¼šè®®
    if now.Weekday() == time.Monday && now.Hour() >= 8 && now.Hour() <= 10 {
        predictions = append(predictions, Prediction{
            Type:       "action",
            Label:      "æŸ¥çœ‹æœ¬å‘¨æ—¥ç¨‹",
            Confidence: 0.8,
            Action:     "view_week_schedule",
        })
    }
    
    // ä¸‹ç­å‰ â†’ æ˜Žæ—¥é¢„è§ˆ
    if now.Hour() >= 17 && now.Hour() <= 18 {
        predictions = append(predictions, Prediction{
            Type:       "action",
            Label:      "æ˜Žå¤©æœ‰ä»€ä¹ˆå®‰æŽ’ï¼Ÿ",
            Confidence: 0.7,
            Action:     "view_tomorrow",
        })
    }
    
    return predictions
}
```

### 3.3 å‰ç«¯å±•ç¤º

```tsx
// web/src/components/ai/PredictionChips.tsx

export function PredictionChips({ predictions, onSelect }: Props) {
  return (
    <div className="flex gap-2 overflow-x-auto pb-2">
      {predictions.map((pred) => (
        <button
          key={pred.action}
          onClick={() => onSelect(pred)}
          className="shrink-0 rounded-full bg-blue-100 px-4 py-2 text-sm text-blue-700 hover:bg-blue-200"
        >
          {pred.label}
        </button>
      ))}
    </div>
  );
}
```

---

## 4. å®žçŽ°è·¯å¾„

| Day | ä»»åŠ¡ |
|-----|------|
| 1-2 | é¢„æµ‹å¼•æ“Žæ ¸å¿ƒé€»è¾‘ |
| 3 | ä¸‰ç§è§¦å‘åœºæ™¯å®žçŽ° |
| 4 | å‰ç«¯ç»„ä»¶ |
| 5 | æµ‹è¯•ä¸Žè°ƒä¼˜ |

---

## 5. éªŒæ”¶æ ‡å‡†

- [ ] å‘¨ä¸€æ—©ä¸Šæ˜¾ç¤º"æœ¬å‘¨æ—¥ç¨‹"é¢„æµ‹
- [ ] é¢„æµ‹å‡†ç¡®çŽ‡ > 60%
- [ ] ç”¨æˆ·ç‚¹å‡»çŽ‡ > 30%

---

> **ç‰ˆæœ¬**: v1.0 | **æ›´æ–°æ—¶é—´**: 2026-01-27
