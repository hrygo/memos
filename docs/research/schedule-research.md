# æ—¥ç¨‹ç®¡ç† Agent ç³»ç»Ÿè°ƒç ”æŠ¥å‘Š

**æ–‡æ¡£å¯¼èˆª**: [ä¸»è·¯çº¿å›¾](./00-master-roadmap.md) | [å®æ–½è·¯çº¿å›¾](./schedule-roadmap.md)

---

## 1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              å‰ç«¯ (React + TypeScript)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Schedule Page    ScheduleQuickInput    StreamingScheduleAssistant          â”‚
â”‚       â”‚                  â”‚                        â”‚                          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                               â”‚
â”‚                    scheduleAgentServiceClient                                â”‚
â”‚                              â”‚ (gRPC-Web / Connect)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â–¼                     åç«¯ (Go)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ScheduleAgentService                              â”‚    â”‚
â”‚  â”‚              (server/router/api/v1/schedule_agent_service.go)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    SchedulerAgentV2                                  â”‚    â”‚
â”‚  â”‚                (plugin/ai/agent/scheduler_v2.go)                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  LLMIntentClassifier   â”‚   Agent (ReAct Loop)   â”‚   Tools   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Schedule Service                                â”‚    â”‚
â”‚  â”‚              (server/service/schedule/service.go)                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  ConflictResolver  â”‚  RecurrenceExpander  â”‚  CRUD Operations â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Store Layer                                  â”‚    â”‚
â”‚  â”‚                    (store/db/postgres/schedule.go)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 2.1 Agent ä¸‰å±‚æ¶æ„

| å±‚çº§ | ç»„ä»¶ | æ–‡ä»¶ä½ç½® | èŒè´£ |
|------|------|----------|------|
| **Parrot å±‚** | ScheduleParrotV2 | `plugin/ai/agent/schedule_parrot_v2.go` | æ¥å£é€‚é…ï¼Œæä¾›ç»Ÿä¸€çš„ ParrotAgent æ¥å£ |
| **Agent å±‚** | SchedulerAgentV2 | `plugin/ai/agent/scheduler_v2.go` | æ ¸å¿ƒé€»è¾‘ï¼ŒReAct å¾ªç¯ï¼Œå·¥å…·ç¼–æ’ |
| **Tool å±‚** | schedule_* tools | `plugin/ai/agent/tools/scheduler.go` | å…·ä½“æ—¥ç¨‹æ“ä½œå®ç° |

### 2.2 æ„å›¾åˆ†ç±»å™¨ (Intent Classifier)

ç³»ç»Ÿé‡‡ç”¨ **åŒå±‚æ„å›¾åˆ†ç±»** ç­–ç•¥ï¼š

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§„åˆ™åˆ†ç±»å™¨ (0ms)    â”‚  â† å…³é”®è¯åŒ¹é…ï¼šæ¯å¤©ã€æ—¥ç¨‹ã€ä¼šè®®...
â”‚  IntentClassifier   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ æ— æ³•ç¡®å®š
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLM åˆ†ç±»å™¨ (~400ms) â”‚  â† Qwen2.5-7B + JSON Schema
â”‚  LLMIntentClassifierâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ„å›¾ç±»å‹ (TaskIntent)**:

| æ„å›¾ | è¯´æ˜ | æ‰§è¡Œæ¨¡å¼ |
|------|------|----------|
| `simple_create` | åˆ›å»ºå•ä¸ªæ—¥ç¨‹ | ReAct |
| `simple_query` | æŸ¥è¯¢æ—¥ç¨‹/ç©ºé—²æ—¶é—´ | ReAct |
| `simple_update` | ä¿®æ”¹/åˆ é™¤æ—¥ç¨‹ | ReAct |
| `batch_create` | æ‰¹é‡åˆ›å»ºï¼ˆæ¯å¤©/æ¯å‘¨ï¼‰ | Plan-Execute (TODO) |
| `conflict_resolve` | å¤„ç†æ—¥ç¨‹å†²çª | ReAct |
| `multi_query` | ç»¼åˆåˆ†ææŸ¥è¯¢ | Plan-Execute (TODO) |

### 2.3 å¯ç”¨å·¥å…· (Tools)

| å·¥å…·å | åŠŸèƒ½ | è°ƒç”¨ä¼˜å…ˆçº§ |
|--------|------|-----------|
| `schedule_query` | æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ—¥ç¨‹ | å¿…é¡»é¦–å…ˆè°ƒç”¨ï¼ˆå†²çªæ£€æµ‹ï¼‰ |
| `schedule_add` | åˆ›å»ºæ–°æ—¥ç¨‹ | åœ¨ query ç¡®è®¤æ— å†²çªåè°ƒç”¨ |
| `schedule_update` | æ›´æ–°å·²æœ‰æ—¥ç¨‹ | éœ€è¦å…ˆ query æ‰¾åˆ°ç›®æ ‡ |
| `find_free_time` | æŸ¥æ‰¾ç©ºé—²æ—¶é—´æ®µ | å†²çªæ—¶æˆ–ç”¨æˆ·è¯¢é—®ç©ºé—²æ—¶è°ƒç”¨ |

---

## 3. Agent æç¤ºè¯å·¥ç¨‹è¯¦è§£

### 3.1 ç³»ç»Ÿæç¤ºè¯ (System Prompt)

**ä½ç½®**: `plugin/ai/agent/scheduler_v2.go:buildSystemPromptV2()`

```go
ä½ æ˜¯æ—¥ç¨‹åŠ©æ‰‹ ğŸ¦œ é‡‘åˆš (Macaw)ã€‚
å½“å‰ç³»ç»Ÿæ—¶é—´: %s (%s)

## æ ¸å¿ƒåŸåˆ™
1. **å…ˆæŸ¥åå»º**: åˆ›å»ºæ—¥ç¨‹å‰å¿…é¡»å…ˆç”¨ schedule_query æ£€æŸ¥è¯¥æ—¶æ®µæ˜¯å¦æœ‰å†²çª
2. **å†²çªå¿…å¤„ç†**: å‘ç°å†²çªæ—¶å¿…é¡»è°ƒç”¨ find_free_time æŸ¥æ‰¾å¯ç”¨æ—¶é—´
3. **é»˜è®¤1å°æ—¶**: ç”¨æˆ·æœªæŒ‡å®šæ—¶é•¿æ—¶ï¼Œé»˜è®¤ä¸º1å°æ—¶
4. **æ—¶é—´æ¨æ–­**: è‹¥æ—¶é—´åœ¨å½“å‰ä¹‹å‰ï¼Œé»˜è®¤è§†ä¸ºæ˜å¤©

## å·¥å…·è°ƒç”¨æœ€ä½³å®è·µ
æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©æœ€ä¼˜è°ƒç”¨é“¾ï¼š

### ç®€å•åˆ›å»º (å¦‚"æ˜å¤©3ç‚¹å¼€ä¼š")
1. schedule_query â†’ æ£€æŸ¥å†²çª
2. schedule_add â†’ åˆ›å»ºæ—¥ç¨‹
âš¡ å…±2æ­¥ï¼Œæœ€é«˜æ•ˆ

### æœ‰å†²çªæ—¶
1. schedule_query â†’ å‘ç°å†²çª
2. find_free_time â†’ æŸ¥æ‰¾ç©ºé—²æ—¶é—´
3. schedule_add â†’ åˆ›å»ºæ—¥ç¨‹
âš¡ å…±3æ­¥

### ä¿®æ”¹æ—¥ç¨‹ (å¦‚"æŠŠä¼šè®®æ”¹åˆ°4ç‚¹")
1. schedule_query â†’ æ‰¾åˆ°ç›®æ ‡æ—¥ç¨‹
2. schedule_update â†’ æ›´æ–°æ—¶é—´

### æŸ¥è¯¢æ—¥ç¨‹ (å¦‚"ä»Šå¤©æœ‰ä»€ä¹ˆå®‰æ’")
1. schedule_query â†’ ç›´æ¥è¿”å›ç»“æœ
âš¡ ä»…1æ­¥

## å“åº”æ ¼å¼
- åˆ›å»ºæˆåŠŸåï¼Œå›å¤æ ¼å¼: "âœ“ å·²åˆ›å»º: [æ ‡é¢˜] ([æ—¶é—´])"
- æ›´æ–°æˆåŠŸåï¼Œå›å¤æ ¼å¼: "âœ“ å·²æ›´æ–°: [æ ‡é¢˜] ([æ–°æ—¶é—´])"
- å¦‚æœ‰å†²çªï¼Œå…ˆè¯´æ˜å†²çªï¼Œå†ç»™å‡ºå»ºè®®æ—¶é—´

## æ³¨æ„äº‹é¡¹
- ä½¿ç”¨ ISO8601 æ ¼å¼ä¼ é€’æ—¶é—´å‚æ•° (å¦‚ 2026-01-27T15:00:00+08:00)
- æ‰€æœ‰æ—¥æœŸæ—¶é—´éƒ½åº”åŸºäºç”¨æˆ·æ—¶åŒº (%s)
- å°½å¯èƒ½ç®€æ´å›ç­”ï¼Œé¿å…å†—ä½™è¯´æ˜

å°½å¯èƒ½ä½¿ç”¨ä¸­æ–‡å›ç­”ã€‚
```

### 3.2 å·¥å…·æè¿°æç¤ºè¯

#### schedule_query å·¥å…·

```
[MUST USE FIRST] Query existing schedules BEFORE creating any new schedule.

IMPORTANT USAGE RULE:
- ALWAYS call this tool BEFORE schedule_add to check for conflicts
- Call this first when user asks about their schedule

Input: {"start_time": "ISO8601", "end_time": "ISO8601"}
Example: {"start_time": "2026-01-25T00:00:00+08:00", "end_time": "2026-01-26T00:00:00+08:00"}

Returns: List of existing schedules or "No schedules found"
```

#### schedule_add å·¥å…·

```
Create a NEW schedule AFTER checking for conflicts with schedule_query.

REQUIRED WORKFLOW:
1. First: Call schedule_query to check availability
2. Only if no conflict: Call schedule_add
3. If conflict exists: Call find_free_time instead

Input: {"title": "event name", "start_time": "ISO8601", "end_time": "ISO8601"}
Example: {"title": "Team Meeting", "start_time": "2026-01-25T15:00:00+08:00", ...}

Note: end_time can be omitted for 1-hour default duration. Auto-adjusts conflicts if enabled.
```

#### find_free_time å·¥å…·

```
Find available 1-hour time slots when schedule_query detects conflicts.

WHEN TO USE:
- After schedule_query returns conflicting schedules
- User asks "when am I free" or similar

Input: {"date": "YYYY-MM-DD"}
Example: {"date": "2026-01-25"}

Returns: ISO8601 start time of available slot (you must add 1 hour for end time)
Error: Returns error message if no slots available (all 8AM-10PM occupied)

IMPORTANT: The returned time is the START only. End time = start + 1 hour.
```

### 3.3 æ„å›¾åˆ†ç±»æç¤ºè¯

**ä½ç½®**: `plugin/ai/agent/llm_intent_classifier.go`

```
æ—¥ç¨‹æ„å›¾åˆ†ç±»å™¨ã€‚æ ¹æ®ç”¨æˆ·è¾“å…¥åˆ¤æ–­æ„å›¾ï¼š

simple_create: åˆ›å»ºå•ä¸ªæ—¥ç¨‹ (æœ‰æ—¶é—´+äº‹ä»¶)
simple_query: æŸ¥è¯¢æ—¥ç¨‹/ç©ºé—² (é—®å¥)
simple_update: ä¿®æ”¹/åˆ é™¤æ—¥ç¨‹
batch_create: é‡å¤æ—¥ç¨‹ (æ¯å¤©/æ¯å‘¨/å·¥ä½œæ—¥)
conflict_resolve: å¤„ç†å†²çª
multi_query: ç»¼åˆåˆ†æ

é»˜è®¤: simple_create
```

---

## 4. æ‰§è¡Œæµç¨‹è¯¦è§£

### 4.1 å…¸å‹åˆ›å»ºæµç¨‹ç¤ºä¾‹

**ç”¨æˆ·è¾“å…¥**: "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æ„å›¾åˆ†ç±»                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è§„åˆ™åˆ†ç±»å™¨æ£€æµ‹åˆ° "ç‚¹" + "å¼€ä¼š" â†’ å‘½ä¸­ simple_create                      â”‚
â”‚ ç½®ä¿¡åº¦: 0.85                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Agent ReAct å¾ªç¯å¼€å§‹                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç³»ç»Ÿæç¤ºè¯ + ç”¨æˆ·è¾“å…¥ â†’ LLM                                               â”‚
â”‚ LLM å†³ç­–: è°ƒç”¨ schedule_query æ£€æŸ¥å†²çª                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: å·¥å…·è°ƒç”¨ - schedule_query                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input: {"start_time": "2026-01-28T15:00:00+08:00",                       â”‚
â”‚         "end_time": "2026-01-28T16:00:00+08:00"}                         â”‚
â”‚ Output: "No schedules found in the specified time range."               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Agent ç»§ç»­å†³ç­–                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LLM è§‚å¯Ÿåˆ°æ— å†²çª â†’ å†³ç­–è°ƒç”¨ schedule_add                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: å·¥å…·è°ƒç”¨ - schedule_add                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input: {"title": "å¼€ä¼š",                                                 â”‚
â”‚         "start_time": "2026-01-28T15:00:00+08:00",                       â”‚
â”‚         "end_time": "2026-01-28T16:00:00+08:00"}                         â”‚
â”‚ Output: "âœ“ å·²åˆ›å»º: å¼€ä¼š (2026-01-28 15:00 CST - 2026-01-28 16:00 CST)"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: æœ€ç»ˆå“åº”                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent è¿”å›: "âœ“ å·²åˆ›å»º: å¼€ä¼š (æ˜å¤©ä¸‹åˆ 15:00-16:00)"                       â”‚
â”‚ äº‹ä»¶æµ: answer â†’ å‰ç«¯æ›´æ–° UI                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å†²çªå¤„ç†æµç¨‹

**ç”¨æˆ·è¾“å…¥**: "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š" (ä½† 3 ç‚¹å·²æœ‰å®‰æ’)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1-2: åŒä¸Šï¼Œæ„å›¾åˆ†ç±» + ReAct å¼€å§‹                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: schedule_query å‘ç°å†²çª                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Output: "Found 1 schedule(s):                                           â”‚
â”‚         1. é¡¹ç›®è¯„å®¡ (2026-01-28 15:00 - 16:00) at ä¼šè®®å®¤A"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Agent å†³ç­–è°ƒç”¨ find_free_time                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input: {"date": "2026-01-28"}                                           â”‚
â”‚ Output: "2026-01-28T16:00:00+08:00"  (ä¸‹åˆ4ç‚¹ç©ºé—²)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: æ™ºèƒ½è·¯å¾„é€‰æ‹© (æœ€å°æ‰“æ‰°åŸåˆ™)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¼˜å…ˆè·¯å¾„ (è‡ªåŠ¨è°ƒæ•´): schedule_add è‡ªåŠ¨ä½¿ç”¨æœ€è¿‘å¯ç”¨æ—¶é—´ 16:00              â”‚
â”‚   â†’ ç›´æ¥å®Œæˆï¼Œä»…åœ¨å“åº”ä¸­å‘ŠçŸ¥ç”¨æˆ·æ—¶é—´å·²è°ƒæ•´                                â”‚
â”‚                                                                         â”‚
â”‚ å¤‡é€‰è·¯å¾„ (éœ€ç¡®è®¤): ä»…å½“è‡ªåŠ¨è°ƒæ•´ä¸å¯è¡Œæ—¶æ‰è¯¢é—®ç”¨æˆ·                         â”‚
â”‚   â†’ å¦‚: å½“å¤©æ— ç©ºé—²ã€ç”¨æˆ·æ˜ç¡®è¦æ±‚ç‰¹å®šæ—¶é—´                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ•°æ®æ¨¡å‹

### 5.1 Schedule æ•°æ®ç»“æ„

```go
type Schedule struct {
    ID              int32      // ä¸»é”®
    UID             string     // UUIDï¼Œç”¨äºå¤–éƒ¨å¼•ç”¨
    CreatorID       int32      // åˆ›å»ºè€…ç”¨æˆ·ID
    RowStatus       RowStatus  // NORMAL / ARCHIVED
    CreatedTs       int64      // åˆ›å»ºæ—¶é—´æˆ³
    UpdatedTs       int64      // æ›´æ–°æ—¶é—´æˆ³
    Title           string     // æ—¥ç¨‹æ ‡é¢˜
    Description     string     // è¯¦ç»†æè¿°
    Location        string     // åœ°ç‚¹
    StartTs         int64      // å¼€å§‹æ—¶é—´ (Unix timestamp)
    EndTs           *int64     // ç»“æŸæ—¶é—´ (å¯é€‰)
    AllDay          bool       // æ˜¯å¦å…¨å¤©äº‹ä»¶
    Timezone        string     // æ—¶åŒº (å¦‚ "Asia/Shanghai")
    RecurrenceRule  *string    // é‡å¤è§„åˆ™ (JSONæ ¼å¼ RRule)
    RecurrenceEndTs *int64     // é‡å¤ç»“æŸæ—¶é—´
    Reminders       *string    // æé†’è®¾ç½® (JSONæ•°ç»„)
    Payload         *string    // æ‰©å±•æ•°æ® (JSON)
}
```

### 5.2 å†²çªæ£€æµ‹ç®—æ³•

```go
// åŒºé—´çº¦å®š: [start, end) å·¦é—­å³å¼€
// ä¸¤ä¸ªåŒºé—´ [s1, e1) å’Œ [s2, e2) é‡å æ¡ä»¶:
// s1 < e2 AND s2 < e1

func (s *Schedule) ConflictWith(other *Schedule) bool {
    sEnd := s.EndTs
    if sEnd == nil {
        sEnd = &s.StartTs
    }
    otherEnd := other.EndTs
    if otherEnd == nil {
        otherEnd = &other.StartTs
    }
    return s.StartTs < *otherEnd && other.StartTs < *sEnd
}
```

---

## 6. å‰ç«¯äº¤äº’

### 6.1 äº‹ä»¶æµç±»å‹

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | å‰ç«¯å¤„ç† |
|----------|------|----------|
| `thinking` | Agent æ­£åœ¨æ€è€ƒ | æ˜¾ç¤ºåŠ è½½åŠ¨ç”» |
| `tool_use` | å¼€å§‹è°ƒç”¨å·¥å…· | æ˜¾ç¤ºå·¥å…·åç§° |
| `tool_result` | å·¥å…·è¿”å›ç»“æœ | å¯å±•å¼€æŸ¥çœ‹è¯¦æƒ… |
| `answer` | æœ€ç»ˆå›ç­” | æ˜¾ç¤ºåœ¨å¯¹è¯æ°”æ³¡ |
| `schedule_updated` | æ—¥ç¨‹å·²æ›´æ–° | åˆ·æ–°æ—¥ç¨‹åˆ—è¡¨ |
| `ui_schedule_suggestion` | å»ºè®®æ—¥ç¨‹ | æ˜¾ç¤ºç¡®è®¤å¡ç‰‡ |
| `ui_conflict_resolution` | å†²çªè§£å†³é€‰é¡¹ | æ˜¾ç¤ºé€‰æ‹©ç•Œé¢ |

### 6.2 æµå¼å“åº”å¤„ç†

```typescript
// web/src/components/AIChat/StreamingScheduleAssistant.tsx

const stream = scheduleAgentServiceClient.chatStream({
  message: userMessage,
  userTimezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
});

for await (const chunk of stream) {
  const event: StreamEvent = JSON.parse(chunk.event);
  
  switch (event.type) {
    case "thinking":
      setIsThinking(true);
      break;
    case "tool_use":
      setCurrentToolCall({ name: parseToolName(event.data), status: "running" });
      break;
    case "tool_result":
      updateToolCallResult(event.data);
      break;
    case "answer":
      setMessages(prev => [...prev, { role: "assistant", content: event.data }]);
      break;
    case "schedule_updated":
      queryClient.invalidateQueries({ queryKey: ["schedules"] });
      break;
  }
}
```

---

## 7. æ”¹è¿›å»ºè®®

### 7.0 è®¾è®¡åŸåˆ™

> **æœ€å°æ‰“æ‰°åŸåˆ™**: å¤šè·¯é€‰æ‹©æ—¶ï¼Œä¼˜å…ˆé€‰æ‹©ä¸æ‰“æ‰°ç”¨æˆ·çš„è·¯å¾„
> **èŒè´£å•ä¸€åŸåˆ™**: å‰ç«¯ä»…åšå±•ç¤ºï¼Œå¤æ‚è§„åˆ™ç”±åç«¯å®ç°

### 7.1 æ•ˆç‡ä¼˜åŒ–

| é—®é¢˜ | ç°çŠ¶ | å»ºè®® |
|------|------|------|
| **å†²çªæ£€æŸ¥å»¶è¿Ÿ** | æ¯æ¬¡åˆ›å»ºéƒ½éœ€ LLM å†³ç­–è°ƒç”¨ query | åç«¯æä¾›è½»é‡é¢„æ£€ APIï¼Œå‰ç«¯ä»…è´Ÿè´£è°ƒç”¨å’Œå±•ç¤º |
| **æ„å›¾åˆ†ç±»å¼€é”€** | LLM åˆ†ç±»éœ€ ~400ms | æ‰©å±•è§„åˆ™åˆ†ç±»å™¨è¦†ç›–ç‡ï¼Œå‡å°‘ LLM è°ƒç”¨ |
| **å·¥å…·è°ƒç”¨è½®æ¬¡** | ç®€å•åˆ›å»ºéœ€ 2 è½® | åç«¯å®ç° "å¿«é€Ÿåˆ›å»º" æ¨¡å¼ï¼Œå•è½®å®Œæˆ |

### 7.2 ç¨³å®šæ€§ä¼˜åŒ–

| é—®é¢˜ | ç°çŠ¶ | å»ºè®® |
|------|------|------|
| **æ—¶é—´è§£æé”™è¯¯** | LLM å¯èƒ½ç”Ÿæˆé”™è¯¯æ ¼å¼ | åç«¯å¢åŠ è¾“å…¥æ ¡éªŒå±‚ï¼Œè‡ªåŠ¨ä¿®æ­£å¸¸è§æ ¼å¼é”™è¯¯ |
| **å·¥å…·è°ƒç”¨å¹»è§‰** | LLM å¯èƒ½è°ƒç”¨ä¸å­˜åœ¨çš„å·¥å…· | ä½¿ç”¨ä¸¥æ ¼ JSON Schema çº¦æŸè¾“å‡º |
| **ä¸Šä¸‹æ–‡ä¸¢å¤±** | æœåŠ¡é‡å¯åä¼šè¯ä¸¢å¤± | å®ç° PostgreSQL æŒä¹…åŒ–ä¼šè¯ä¸Šä¸‹æ–‡ |

### 7.3 å‡†ç¡®æ€§ä¼˜åŒ–

| é—®é¢˜ | ç°çŠ¶ | å»ºè®® |
|------|------|------|
| **æ—¶é—´æ¨æ–­æ¨¡ç³Š** | "ä¸‹åˆ" å¯èƒ½è¢«è§£æä¸ºä¸åŒæ—¶é—´ | åç«¯è§£æååœ¨å“åº”ä¸­æ˜ç¡®å‘ŠçŸ¥å®é™…æ—¶é—´ï¼Œæ— éœ€ç”¨æˆ·ç¡®è®¤ |
| **é‡å¤æ—¥ç¨‹è§£æ** | æ‰¹é‡åˆ›å»ºæ”¯æŒæœ‰é™ | å®Œå–„ Plan-Execute æ¨¡å¼ï¼Œæ”¯æŒå¤æ‚é‡å¤è§„åˆ™ |
| **å†²çªæ£€æµ‹èŒƒå›´** | ä»…æ£€æŸ¥ç²¾ç¡®æ—¶é—´æ®µ | åç«¯å¢åŠ ç¼“å†²æ—¶é—´é€‰é¡¹ï¼ˆå¦‚å‰å15åˆ†é’Ÿï¼‰ |

### 7.4 æ¶æ„æ”¹è¿›å»ºè®®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å»ºè®®æ¶æ„æ”¹è¿› (èŒè´£åˆ†ç¦» + æœ€å°æ‰“æ‰°)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. åç«¯é¢„æ£€ API (èŒè´£å•ä¸€)                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚  GET /api/v1/schedules/check?start=&end=                 â”‚       â”‚
â”‚     â”‚  è¿”å›: { hasConflict: bool, conflicts: [], suggestion: } â”‚       â”‚
â”‚     â”‚  å‰ç«¯ä»…è°ƒç”¨ + å±•ç¤ºï¼Œä¸åšè§„åˆ™åˆ¤æ–­                           â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  2. æ™ºèƒ½è‡ªåŠ¨è°ƒæ•´ (æœ€å°æ‰“æ‰°)                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚  å†²çªæ—¶ â†’ è‡ªåŠ¨é€‰æ‹©æœ€è¿‘å¯ç”¨æ—¶é—´ â†’ ç›´æ¥åˆ›å»º                  â”‚       â”‚
â”‚     â”‚  å“åº”: "âœ“ å·²åˆ›å»º: å¼€ä¼š (16:00ï¼ŒåŸæ—¶é—´ 15:00 æœ‰å†²çª)"       â”‚       â”‚
â”‚     â”‚  ä»…å½“æ— æ³•è‡ªåŠ¨è°ƒæ•´æ—¶æ‰è¯¢é—®ç”¨æˆ·                              â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  3. å¿«é€Ÿæ¨¡å¼ (Fast Path)                                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚  ç®€å•åˆ›å»º â†’ åç«¯ä¸€æ­¥å®Œæˆ (æ£€æµ‹+è°ƒæ•´+åˆ›å»º)                  â”‚       â”‚
â”‚     â”‚  æ— éœ€ LLM å¤šè½®å†³ç­–ï¼Œæå‡å“åº”é€Ÿåº¦                           â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  4. ä¼šè¯æŒä¹…åŒ–                                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚  ConversationContext â†’ PostgreSQL                        â”‚       â”‚
â”‚     â”‚  æ”¯æŒ: è·¨è®¾å¤‡åŒæ­¥ã€æœåŠ¡é‡å¯æ¢å¤ã€å†å²å›æº¯                  â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  5. åç«¯æ™ºèƒ½ç¼“å­˜                                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚     â”‚  å¸¸ç”¨æ—¶é—´æ®µé¢„åŠ è½½ + å†²çªæ£€æµ‹ç»“æœç¼“å­˜                       â”‚       â”‚
â”‚     â”‚  TTL: 5åˆ†é’Ÿï¼Œå†™æ“ä½œè§¦å‘å¤±æ•ˆ                                â”‚       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. å…³é”®æ–‡ä»¶ç´¢å¼•

| æ¨¡å— | æ–‡ä»¶ | æ ¸å¿ƒåŠŸèƒ½ |
|------|------|----------|
| **Agent å…¥å£** | `plugin/ai/agent/schedule_parrot_v2.go` | ParrotAgent æ¥å£å®ç° |
| **Agent æ ¸å¿ƒ** | `plugin/ai/agent/scheduler_v2.go` | ReAct å¾ªç¯ã€æç¤ºè¯æ„å»º |
| **æ„å›¾åˆ†ç±»** | `plugin/ai/agent/intent_classifier.go` | è§„åˆ™åˆ†ç±»å™¨ |
| **æ„å›¾åˆ†ç±»(LLM)** | `plugin/ai/agent/llm_intent_classifier.go` | LLM åˆ†ç±»å™¨ |
| **å·¥å…·å®ç°** | `plugin/ai/agent/tools/scheduler.go` | å››ä¸ªæ—¥ç¨‹å·¥å…· |
| **å†²çªè§£å†³** | `server/service/schedule/conflict_resolver.go` | å†²çªæ£€æµ‹ä¸å»ºè®® |
| **æœåŠ¡å±‚** | `server/service/schedule/service.go` | ä¸šåŠ¡é€»è¾‘ |
| **API æœåŠ¡** | `server/router/api/v1/schedule_agent_service.go` | gRPC æœåŠ¡ |
| **å‰ç«¯é¡µé¢** | `web/src/pages/Schedule.tsx` | æ—¥ç¨‹ä¸»é¡µ |
| **æµå¼ç»„ä»¶** | `web/src/components/AIChat/StreamingScheduleAssistant.tsx` | æµå¼å¯¹è¯ |
| **Hook** | `web/src/hooks/useScheduleAgent.ts` | å‰ç«¯ Agent è°ƒç”¨ |

---

## 9. æ€»ç»“

å½“å‰æ—¥ç¨‹ç®¡ç† Agent ç³»ç»Ÿé‡‡ç”¨äº†æˆç†Ÿçš„ ReAct æ¶æ„ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

**ä¼˜åŠ¿**:
- åŒå±‚æ„å›¾åˆ†ç±»ï¼ˆè§„åˆ™+LLMï¼‰å¹³è¡¡äº†é€Ÿåº¦å’Œå‡†ç¡®æ€§
- å·¥å…·æè¿°æ¸…æ™°ï¼ŒåŒ…å«æ˜ç¡®çš„è°ƒç”¨é¡ºåºæŒ‡å¯¼
- å†²çªæ£€æµ‹å’Œè‡ªåŠ¨è°ƒæ•´æœºåˆ¶å®Œå–„
- æµå¼å“åº”æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

**å¾…æ”¹è¿›**:
- ä¼šè¯ä¸Šä¸‹æ–‡éœ€è¦æŒä¹…åŒ–
- Plan-Execute æ¨¡å¼å°šæœªå®Œæ•´å®ç°
- æ‰¹é‡æ“ä½œå’Œå¤æ‚é‡å¤è§„åˆ™æ”¯æŒæœ‰é™

**æ”¹è¿›åŸåˆ™**:
1. **æœ€å°æ‰“æ‰°**: å¤šè·¯é€‰æ‹©æ—¶ä¼˜å…ˆè‡ªåŠ¨å¤„ç†ï¼Œä»…åœ¨å¿…è¦æ—¶æ‰è¯¢é—®ç”¨æˆ·
2. **èŒè´£å•ä¸€**: å‰ç«¯ä»…åšå±•ç¤ºå’Œè°ƒç”¨ï¼Œå¤æ‚è§„åˆ™åˆ¤æ–­ç”±åç«¯ç»Ÿä¸€å®ç°
3. **æ¸è¿›ä¼˜åŒ–**: æŒ‰ **æ•ˆç‡ â†’ ç¨³å®šæ€§ â†’ å‡†ç¡®æ€§** çš„ä¼˜å…ˆçº§é€æ­¥è¿­ä»£
